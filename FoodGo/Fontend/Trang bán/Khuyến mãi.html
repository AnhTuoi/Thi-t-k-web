<!DOCTYPE html>
<html class="light" lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Khuyến mãi - FoodGo</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f48c25",
                        "background-light": "#f8f7f5",
                        "background-dark": "#221910",
                        "secondary": "#10b981",
                        "danger": "#ef4444"
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "3xl": "1.5rem",
                        "full": "9999px"
                    },
                    screens: {
                        'xs': '475px',
                        '3xl': '1920px',
                    }
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: "Plus Jakarta Sans", sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-outlined.fill {
            font-variation-settings: 'FILL' 1;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .voucher-card {
            transition: all 0.2s ease;
        }
        .voucher-card:hover {
            transform: translateY(-2px);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f48c25;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .typing-indicator {
            display: inline-block;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f48c25;
            margin: 0 2px;
            opacity: 0.4;
        }
        .typing-indicator span:nth-child(1) { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(2) { animation: bounce 1.4s infinite 0.2s ease-in-out both; }
        .typing-indicator span:nth-child(3) { animation: bounce 1.4s infinite 0.4s ease-in-out both; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }
        .chatbot-launcher {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 140, 37, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 140, 37, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 140, 37, 0); }
        }
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#1c140d] dark:text-[#fcfaf8] min-h-screen">
    <div class="layout-container flex flex-col items-center">
        <!-- Header -->
        <header class="w-full sticky top-0 z-50 bg-white/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-[#f4ede7] dark:border-[#3d2e1f] px-4 md:px-6 lg:px-8 xl:px-20 py-3">
            <div class="max-w-[1200px] mx-auto flex items-center justify-between gap-4 md:gap-8">
                <!-- Logo -->
                <a class="flex items-center gap-2 text-primary shrink-0" href="Trang chủ.html">
                    <span class="material-symbols-outlined text-3xl md:text-4xl font-bold">fastfood</span>
                    <h2 class="text-xl md:text-2xl font-black tracking-tighter">FoodGo</h2>
                </a>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="lg:hidden p-2 rounded-xl bg-[#f4ede7] dark:bg-[#3d2e1f]">
                    <span class="material-symbols-outlined text-2xl">menu</span>
                </button>
                
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center gap-6 xl:gap-8 shrink-0">
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors" href="Trang chủ.html">Trang chủ</a>
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors" href="Thực đơn.html">Thực đơn</a>
                    <a class="text-sm font-bold text-primary transition-colors" href="Khuyến mãi.html">Khuyến mãi</a>
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors" href="Đơn hàng.html">Đơn hàng</a>
                </nav>
                
                <!-- Search Bar (Desktop) -->
                <div class="hidden md:flex flex-1 max-w-md mx-4">
                    <label class="relative w-full">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-[#9c7349]">
                            <span class="material-symbols-outlined text-xl">search</span>
                        </span>
                        <input id="search-input" class="w-full h-10 md:h-11 pl-10 pr-4 rounded-2xl border-none bg-[#f4ede7] dark:bg-[#3d2e1f] text-[#1c140d] dark:text-white placeholder:text-[#9c7349] focus:ring-2 focus:ring-primary/50 transition-all text-sm" 
                               placeholder="Tìm kiếm mã giảm giá..." type="text"/>
                    </label>
                </div>
                
                <!-- User Actions -->
                <div class="flex items-center gap-3 md:gap-4 shrink-0">
                    <!-- Search Button (Mobile) -->
                    <button id="mobile-search-button" class="md:hidden p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all">
                        <span class="material-symbols-outlined text-2xl">search</span>
                    </button>
                    
                    <!-- Auth Section -->
                    <div id="auth-section">
                        <!-- Not logged in -->
                        <div id="not-logged-in" style="display: none;">
                            <div class="flex items-center gap-2">
                                <a href="Đăng nhập.html" class="px-4 md:px-6 py-2 md:py-2.5 bg-primary text-white font-bold rounded-2xl hover:opacity-90 transition-all text-sm whitespace-nowrap">
                                    Đăng nhập
                                </a>
                            </div>
                        </div>
                        
                        <!-- Logged in -->
                        <div id="logged-in" style="display: none;">
                            <div class="flex items-center gap-2 md:gap-3">
                                <!-- User Info (Desktop) -->
                                <div class="hidden md:block text-right">
                                    <p class="text-sm font-bold truncate max-w-[120px]" id="user-name"></p>
                                    <p class="text-[10px] text-[#9c7349] truncate max-w-[120px]" id="user-role"></p>
                                </div>
                                
                                <!-- User Avatar -->
                                <div class="h-9 md:h-10 w-9 md:w-10 rounded-2xl bg-cover bg-center border-2 border-primary cursor-pointer hover:scale-105 transition-transform" 
                                     style='background-image: url("https://lh3.googleusercontent.com/a/ACg8ocKx4vBv3k7QY2nHwW6tQ7Lm9J1pRfL6s3V2b5d8h0j");'>
                                </div>
                                
                                <!-- Logout Button -->
                                <button id="logout-button" class="p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all">
                                    <span class="material-symbols-outlined text-xl">logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cart & Notifications -->
                    <div class="flex items-center gap-1 md:gap-2">
                        <a href="Giỏ hàng & Thanh toán.html" class="relative p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all group">
                            <span class="material-symbols-outlined text-2xl group-hover:text-primary transition-colors">shopping_cart</span>
                            <span id="cart-count" class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910]">0</span>
                        </a>
                        <a href="Thông báo.html" class="p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all group">
                            <span class="material-symbols-outlined text-2xl group-hover:text-primary transition-colors">notifications</span>
                            <span id="notification-count" class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910]">3</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div id="mobile-search-bar" class="md:hidden mt-3 hidden">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-[#9c7349]">
                        <span class="material-symbols-outlined text-xl">search</span>
                    </span>
                    <input id="mobile-search-input" class="w-full h-11 pl-10 pr-4 rounded-2xl border-none bg-[#f4ede7] dark:bg-[#3d2e1f] text-[#1c140d] dark:text-white placeholder:text-[#9c7349] focus:ring-2 focus:ring-primary/50 transition-all text-sm" 
                           placeholder="Tìm kiếm mã giảm giá..." type="text"/>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="lg:hidden mt-3 hidden bg-white dark:bg-[#2a2015] rounded-2xl border border-[#f4ede7] dark:border-[#3d2e1f] p-4">
                <nav class="space-y-3">
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Trang chủ.html">
                        <span class="material-symbols-outlined">home</span>
                        Trang chủ
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Thực đơn.html">
                        <span class="material-symbols-outlined">restaurant_menu</span>
                        Thực đơn
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-primary bg-primary/10 rounded-xl" href="Khuyến mãi.html">
                        <span class="material-symbols-outlined">redeem</span>
                        Khuyến mãi
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Đơn hàng.html">
                        <span class="material-symbols-outlined">receipt_long</span>
                        Đơn hàng
                    </a>
                    
                    <!-- Mobile User Info -->
                    <div id="mobile-user-info" class="pt-4 border-t border-[#f4ede7] dark:border-[#3d2e1f] hidden">
                        <div class="flex items-center gap-3 px-4 py-3">
                            <div class="h-10 w-10 rounded-xl bg-cover bg-center border-2 border-primary" 
                                 style='background-image: url("https://lh3.googleusercontent.com/a/ACg8ocKx4vBv3k7QY2nHwW6tQ7Lm9J1pRfL6s3V2b5d8h0j");'></div>
                            <div>
                                <p class="text-sm font-bold" id="mobile-user-name"></p>
                                <p class="text-xs text-[#9c7349]" id="mobile-user-role"></p>
                            </div>
                        </div>
                        <button id="mobile-logout-button" class="w-full flex items-center gap-3 px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors">
                            <span class="material-symbols-outlined">logout</span>
                            Đăng xuất
                        </button>
                    </div>
                    
                    <!-- Mobile Login Button -->
                    <div id="mobile-login-button" class="pt-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                        <a href="Đăng nhập.html" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                            <span class="material-symbols-outlined">login</span>
                            Đăng nhập
                        </a>
                    </div>
                </nav>
            </div>
        </header>

        <!-- AI Chatbot Launcher Button -->
        <button id="chatbot-launcher" class="fixed bottom-6 right-6 z-50 w-14 h-14 bg-primary text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition-all duration-300 chatbot-launcher">
            <span class="material-symbols-outlined text-2xl">smart_toy</span>
            <span id="chat-notification" class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910] hidden">1</span>
        </button>

        <!-- AI Chatbot Window -->
        <div id="chatbot-window" class="fixed bottom-24 right-6 z-50 w-80 md:w-96 h-[500px] bg-white dark:bg-[#2a2015] rounded-2xl shadow-2xl border border-[#f4ede7] dark:border-[#3d2e1f] overflow-hidden flex flex-col hidden">
            <!-- Chatbot Header -->
            <div class="p-4 border-b border-[#f4ede7] dark:border-[#3d2e1f] bg-primary/5">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center">
                            <span class="material-symbols-outlined text-primary">smart_toy</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-sm">FoodGo Assistant</h3>
                            <p class="text-xs text-[#9c7349]">AI đang trực tuyến</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="minimize-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">minimize</span>
                        </button>
                        <button id="close-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">close</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto no-scrollbar space-y-4">
                <!-- Welcome message -->
                <div class="chatbot-message">
                    <div class="flex items-end gap-2">
                        <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                            <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                        </div>
                        <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                            <p class="text-sm">Xin chào! Tôi là FoodGo Assistant. Tôi có thể giúp bạn:</p>
                            <ul class="text-xs mt-2 space-y-1">
                                <li>• Tìm mã giảm giá phù hợp</li>
                                <li>• Hướng dẫn sử dụng voucher</li>
                                <li>• So sánh ưu đãi</li>
                                <li>• Giải đáp thắc mắc về khuyến mãi</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Suggestions -->
            <div id="quick-suggestions" class="px-4 pb-3 border-t border-[#f4ede7] dark:border-[#3d2e1f] pt-3">
                <div class="flex flex-wrap gap-2">
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">sell</span>
                        Giảm giá cao nhất
                    </button>
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">schedule</span>
                        Sắp hết hạn
                    </button>
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">local_shipping</span>
                        Miễn phí ship
                    </button>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="p-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                <div class="relative">
                    <input id="chatbot-input" type="text" placeholder="Nhập câu hỏi về khuyến mãi..." 
                           class="w-full h-12 pl-4 pr-12 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] border-none text-sm focus:ring-2 focus:ring-primary/50 outline-none"/>
                    <button id="send-message" class="absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 bg-primary text-white rounded-full flex items-center justify-center hover:opacity-90">
                        <span class="material-symbols-outlined text-sm">send</span>
                    </button>
                </div>
                <p class="text-[10px] text-[#9c7349] mt-2 text-center">FoodGo Assistant có thể mắc lỗi. Vui lòng kiểm tra thông tin quan trọng.</p>
            </div>
        </div>

        <!-- Mobile AI Chatbot -->
        <div id="mobile-chatbot-window" class="fixed inset-0 z-50 bg-black/50 hidden lg:hidden">
            <div class="absolute inset-0 bg-black/50" id="mobile-chatbot-backdrop"></div>
            <div class="absolute bottom-0 left-0 right-0 h-4/5 bg-white dark:bg-[#2a2015] rounded-t-2xl overflow-hidden flex flex-col">
                <!-- Mobile Chatbot Header -->
                <div class="p-4 border-b border-[#f4ede7] dark:border-[#3d2e1f] bg-primary/5">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary">smart_toy</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-sm">FoodGo Assistant</h3>
                                <p class="text-xs text-[#9c7349]">AI đang trực tuyến</p>
                            </div>
                        </div>
                        <button id="close-mobile-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">close</span>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Chat Messages -->
                <div id="mobile-chatbot-messages" class="flex-1 p-4 overflow-y-auto no-scrollbar space-y-4">
                    <div class="chatbot-message">
                        <div class="flex items-end gap-2">
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                            </div>
                            <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                <p class="text-sm">Xin chào! Tôi có thể giúp bạn tìm mã giảm giá phù hợp!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Quick Suggestions -->
                <div id="mobile-quick-suggestions" class="px-4 pb-3 border-t border-[#f4ede7] dark:border-[#3d2e1f] pt-3">
                    <div class="flex flex-wrap gap-2">
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">sell</span>
                            Giảm giá cao
                        </button>
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">schedule</span>
                            Sắp hết hạn
                        </button>
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">local_shipping</span>
                            Free ship
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Chat Input -->
                <div class="p-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                    <div class="relative">
                        <input id="mobile-chatbot-input" type="text" placeholder="Nhập câu hỏi về khuyến mãi..." 
                               class="w-full h-12 pl-4 pr-12 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] border-none text-sm focus:ring-2 focus:ring-primary/50 outline-none"/>
                        <button id="send-mobile-message" class="absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 bg-primary text-white rounded-full flex items-center justify-center hover:opacity-90">
                            <span class="material-symbols-outlined text-sm">send</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="fixed inset-0 bg-black/20 flex items-center justify-center z-[1000] hidden">
            <div class="loading-spinner"></div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed top-4 right-4 z-[1000] hidden">
            <div class="bg-white dark:bg-[#2a2015] rounded-xl shadow-2xl border border-[#f4ede7] dark:border-[#3d2e1f] p-4 max-w-xs flex items-center gap-3 fade-in">
                <div id="toast-icon" class="h-10 w-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined">check_circle</span>
                </div>
                <div class="flex-1">
                    <p class="font-bold text-sm" id="toast-title"></p>
                    <p class="text-xs text-[#9c7349]" id="toast-message"></p>
                </div>
                <button onclick="hideToast()" class="text-gray-400 hover:text-gray-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main id="khuyenMai" class="w-full max-w-[1200px] px-4 md:px-6 lg:px-8 xl:px-10 py-6 md:py-8">
            <div class="flex flex-col lg:flex-row gap-6 md:gap-8">
                <!-- Sidebar Filter -->
                <aside class="w-full lg:w-1/4 shrink-0">
                    <div class="sticky top-24 bg-white dark:bg-[#2a2015] p-5 md:p-6 rounded-2xl md:rounded-3xl border border-[#f4ede7] dark:border-[#3d2e1f] shadow-sm">
                        <div class="flex items-center justify-between mb-5 md:mb-6">
                            <h3 class="text-base md:text-lg font-bold">Bộ lọc khuyến mãi</h3>
                            <button id="clear-filters" class="text-xs text-primary font-bold hover:underline">Xóa tất cả</button>
                        </div>
                        
                        <!-- Loại khuyến mãi -->
                        <div class="mb-6 md:mb-8">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Loại khuyến mãi</h4>
                            <div class="flex flex-col gap-2 md:gap-3">
                                <label class="flex items-center gap-3 cursor-pointer group" data-type="all">
                                    <input type="checkbox" class="type-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" checked>
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Tất cả</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group" data-type="percent">
                                    <input type="checkbox" class="type-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Giảm theo %</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group" data-type="cash">
                                    <input type="checkbox" class="type-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Giảm tiền mặt</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group" data-type="freeship">
                                    <input type="checkbox" class="type-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Miễn phí ship</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group" data-type="combo">
                                    <input type="checkbox" class="type-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Combo tiết kiệm</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Trạng thái -->
                        <div class="mb-6 md:mb-8">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Trạng thái</h4>
                            <div class="flex flex-col gap-2 md:gap-3">
                                <label class="flex items-center gap-3 cursor-pointer group">
                                    <input type="checkbox" class="status-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" data-status="active" checked>
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Đang hoạt động</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group">
                                    <input type="checkbox" class="status-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" data-status="expiring">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Sắp hết hạn</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group">
                                    <input type="checkbox" class="status-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" data-status="new">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Mới nhất</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer group">
                                    <input type="checkbox" class="status-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" data-status="popular">
                                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Phổ biến nhất</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Giá trị tối thiểu -->
                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Giá trị tối thiểu</h4>
                            <div class="px-2">
                                <input id="min-value-range" class="w-full h-1.5 bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-lg appearance-none cursor-pointer accent-primary" 
                                       max="500000" min="0" step="50000" type="range" value="100000"/>
                                <div class="flex justify-between mt-3">
                                    <span class="text-xs font-bold text-[#9c7349]">0đ</span>
                                    <span id="current-min-value" class="text-xs font-bold text-primary">100.000đ</span>
                                    <span class="text-xs font-bold text-[#9c7349]">500.000đ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Áp dụng bộ lọc -->
                        <button id="apply-filters" class="w-full h-12 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                            Áp dụng bộ lọc
                        </button>
                    </div>
                </aside>
                
                <!-- Main Content -->
                <div class="flex-1">
                    <!-- Header với sắp xếp -->
                    <div class="flex flex-col sm:flex-row items-center justify-between mb-6 md:mb-8 gap-4">
                        <div>
                            <h2 class="text-xl md:text-2xl font-black tracking-tight">Khuyến mãi & Ưu đãi</h2>
                            <p id="result-count" class="text-sm text-[#9c7349]">Đang tải...</p>
                        </div>
                        <div class="flex gap-2">
                            <select id="sort-select" class="h-11 px-4 rounded-2xl bg-white dark:bg-[#2a2015] border border-[#f4ede7] dark:border-[#3d2e1f] text-sm font-bold focus:ring-primary cursor-pointer outline-none">
                                <option value="newest">Mới nhất</option>
                                <option value="popular">Phổ biến nhất</option>
                                <option value="discount_high">Giảm giá cao nhất</option>
                                <option value="expiring">Sắp hết hạn</option>
                                <option value="min_value">Đơn tối thiểu thấp</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Voucher Grid -->
                    <div id="vouchers-grid" class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <!-- Vouchers will be loaded from database -->
                        <div class="col-span-full text-center py-8">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-4 text-[#9c7349]">Đang tải khuyến mãi...</p>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="flex justify-center mt-8 md:mt-12 gap-2">
                        <button id="prev-page" class="w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors">
                            <span class="material-symbols-outlined">chevron_left</span>
                        </button>
                        <div id="pagination-numbers" class="flex gap-2">
                            <button class="w-10 h-10 rounded-xl bg-primary text-white font-bold flex items-center justify-center">1</button>
                        </div>
                        <button id="next-page" class="w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chi tiết voucher Modal -->
        <div id="voucher-detail-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000] p-4">
            <div class="bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-3xl w-full max-w-md md:max-w-lg max-h-[90vh] overflow-hidden">
                <div class="p-6 border-b border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-between">
                    <h3 class="text-xl font-bold">Chi tiết khuyến mãi</h3>
                    <button onclick="closeVoucherModal()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-[#3d2e1f] transition-colors">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div id="voucher-detail-content" class="p-6 overflow-y-auto max-h-[70vh]">
                    <!-- Voucher detail will be loaded here -->
                    <div class="text-center py-8">
                        <div class="loading-spinner mx-auto"></div>
                        <p class="mt-4 text-[#9c7349]">Đang tải thông tin...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="w-full bg-[#1c140d] dark:bg-[#110d08] text-white py-10 md:py-16 mt-10 md:mt-20">
            <div class="max-w-[1200px] mx-auto px-4 md:px-6 lg:px-8 xl:px-10">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
                    <!-- Company Info -->
                    <div class="flex flex-col gap-4 md:gap-6">
                        <div class="flex items-center gap-2 text-primary">
                            <span class="material-symbols-outlined text-3xl font-bold">fastfood</span>
                            <h2 class="text-2xl font-extrabold tracking-tight">FoodGo</h2>
                        </div>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            FoodGo mang đến trải nghiệm ẩm thực tuyệt vời ngay tại nhà. Chúng tôi cam kết chất lượng món ăn và tốc độ giao hàng nhanh nhất.
                        </p>
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">call</span>
                                <span class="text-sm">1900 1234</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">mail</span>
                                <span class="text-sm">support@foodgo.vn</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">location_on</span>
                                <span class="text-sm">Quận 1, TP. Hồ Chí Minh</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Liên kết nhanh</h4>
                        <ul class="text-gray-400 text-sm space-y-3 md:space-y-4">
                            <li><a class="hover:text-primary transition-colors" href="Trang chủ.html">Trang chủ</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Thực đơn.html">Thực đơn</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Khuyến mãi.html">Khuyến mãi</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Đơn hàng.html">Đơn hàng</a></li>
                        </ul>
                    </div>
                    
                    <!-- Customer Support -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Hỗ trợ khách hàng</h4>
                        <ul class="text-gray-400 text-sm space-y-3 md:space-y-4">
                            <li><a class="hover:text-primary transition-colors" href="#">Trung tâm trợ giúp</a></li>
                            <li><a class="hover:text-primary transition-colors" href="#">Chính sách hoàn tiền</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Đơn hàng.html">Theo dõi đơn hàng</a></li>
                            <li><a class="hover:text-primary transition-colors" href="#">Câu hỏi thường gặp</a></li>
                        </ul>
                    </div>
                    
                    <!-- Download App -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Tải ứng dụng</h4>
                        <p class="text-gray-400 text-sm mb-3 md:mb-4">Trải nghiệm đặt món tốt hơn trên điện thoại của bạn.</p>
                        <div class="flex flex-col gap-3">
                            <button class="bg-[#2a2015] px-4 md:px-6 py-3 rounded-xl flex items-center gap-3 text-sm font-bold hover:bg-gray-800 transition-colors border border-gray-700">
                                <span class="material-symbols-outlined">ios</span>
                                <div class="text-left">
                                    <p class="text-[10px] font-normal opacity-70">Download on the</p>
                                    <p class="text-xs md:text-sm">App Store</p>
                                </div>
                            </button>
                            <button class="bg-[#2a2015] px-4 md:px-6 py-3 rounded-xl flex items-center gap-3 text-sm font-bold hover:bg-gray-800 transition-colors border border-gray-700">
                                <span class="material-symbols-outlined">play_arrow</span>
                                <div class="text-left">
                                    <p class="text-[10px] font-normal opacity-70">Get it on</p>
                                    <p class="text-xs md:text-sm">Google Play</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Copyright -->
                <div class="border-t border-gray-800 mt-8 md:mt-16 pt-6 md:pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500">
                    <p class="text-center md:text-left mb-3 md:mb-0">© 2024 FoodGo. Bản quyền thuộc về FoodGo Team.</p>
                    <div class="flex gap-4 md:gap-6">
                        <a class="hover:text-white transition-colors" href="#">Chính sách bảo mật</a>
                        <a class="hover:text-white transition-colors" href="#">Điều khoản sử dụng</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Logout Modal -->
    <div id="logout-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000] p-4">
        <div class="bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-3xl p-6 md:p-8 max-w-sm w-full text-center">
            <div class="h-14 w-14 md:h-16 md:w-16 bg-orange-100 text-primary rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-2xl md:text-3xl">logout</span>
            </div>
            <h3 class="text-lg md:text-xl font-black mb-4">Đăng xuất</h3>
            <p class="text-[#9c7349] mb-6">Bạn có chắc chắn muốn đăng xuất khỏi tài khoản?</p>
            <div class="flex gap-3">
                <button id="cancel-logout" class="flex-1 h-11 md:h-12 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-all">
                    Hủy
                </button>
                <button id="confirm-logout" class="flex-1 h-11 md:h-12 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                    Đăng xuất
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'api'; // Đổi thành đường dẫn API của bạn
        let currentVoucherId = null;
        let currentPage = 1;
        let totalPages = 1;
        let filters = {
            type: ['all'],
            status: ['active'],
            min_order_value: 100000,
            sort_by: 'newest'
        };
        
        // Chatbot state
        let isChatbotOpen = false;
        let unreadMessages = 0;

        // Initialize demo data
        function initDemoData() {
            if (!localStorage.getItem('foodgo_users')) {
                const demoUsers = [
                    {
                        id: 1,
                        fullName: "Nguyễn Văn Khách",
                        phone: "0912345678",
                        email: "customer@foodgo.vn",
                        username: "customer123",
                        password: "123456",
                        role: "customer",
                        createdAt: "2024-01-01"
                    },
                    {
                        id: 2,
                        fullName: "Trần Thị Nhân Viên",
                        phone: "0923456789",
                        email: "staff@foodgo.vn",
                        username: "staff456",
                        password: "123456",
                        role: "staff",
                        createdAt: "2024-01-01"
                    },
                    {
                        id: 3,
                        fullName: "Admin FoodGo",
                        phone: "0934567890",
                        email: "admin@foodgo.vn",
                        username: "admin789",
                        password: "123456",
                        role: "admin",
                        createdAt: "2024-01-01"
                    }
                ];
                localStorage.setItem('foodgo_users', JSON.stringify(demoUsers));
            }
            
            if (!localStorage.getItem('foodgo_cart')) {
                localStorage.setItem('foodgo_cart', JSON.stringify([]));
            }
            
            // Initialize vouchers data
            if (!localStorage.getItem('foodgo_vouchers')) {
                const demoVouchers = [
                    {
                        id: 1,
                        code: "SUMMER24",
                        name: "Chào hè rực rỡ",
                        description: "Giảm 20% cho tất cả đơn hàng. Áp dụng cho tất cả món ăn trong menu. Không áp dụng với các khuyến mãi khác.",
                        discount_type: "percent",
                        discount_value: 20,
                        min_order_amount: 250000,
                        max_discount: 50000,
                        expired_at: "2024-08-31",
                        total_quantity: 1000,
                        used_quantity: 456,
                        remaining_quantity: 544,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: true,
                        is_popular: true,
                        created_at: "2024-05-01",
                        usage_percentage: 45,
                        days_remaining: 92
                    },
                    {
                        id: 2,
                        code: "HELLOFOOD",
                        name: "Chào Bạn Mới FoodGo",
                        description: "Giảm 50k cho đơn hàng đầu tiên. Dành cho khách hàng mới đăng ký tài khoản.",
                        discount_type: "cash",
                        discount_value: 50000,
                        min_order_amount: 0,
                        max_discount: 50000,
                        expired_at: "2024-06-15",
                        total_quantity: 500,
                        used_quantity: 234,
                        remaining_quantity: 266,
                        image_url: "https://images.unsplash.com/photo-1571066811602-716837d681de?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: true,
                        is_popular: false,
                        created_at: "2024-05-15",
                        usage_percentage: 46,
                        days_remaining: 45
                    },
                    {
                        id: 3,
                        code: "FREESHIP",
                        name: "Miễn phí vận chuyển",
                        description: "Miễn phí ship cho đơn hàng từ 100k. Áp dụng trong phạm vi 5km.",
                        discount_type: "freeship",
                        discount_value: 25000,
                        min_order_amount: 100000,
                        max_discount: 25000,
                        expired_at: "2024-06-20",
                        total_quantity: 1000,
                        used_quantity: 567,
                        remaining_quantity: 433,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: false,
                        is_popular: true,
                        created_at: "2024-05-20",
                        usage_percentage: 56,
                        days_remaining: 50
                    },
                    {
                        id: 4,
                        code: "FAMILY15",
                        name: "Combo Gia Đình Sum Vầy",
                        description: "Giảm 15% cho tất cả Combo Gia đình. Chỉ áp dụng cho combo từ 3 món trở lên.",
                        discount_type: "percent",
                        discount_value: 15,
                        min_order_amount: 200000,
                        max_discount: 75000,
                        expired_at: "2024-05-30",
                        total_quantity: 300,
                        used_quantity: 289,
                        remaining_quantity: 11,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: false,
                        is_popular: false,
                        created_at: "2024-04-01",
                        usage_percentage: 96,
                        days_remaining: 15
                    },
                    {
                        id: 5,
                        code: "WEEKEND30",
                        name: "Ưu đãi cuối tuần",
                        description: "Giảm 30% cho đơn hàng cuối tuần. Chỉ áp dụng từ thứ 6 đến chủ nhật.",
                        discount_type: "percent",
                        discount_value: 30,
                        min_order_amount: 150000,
                        max_discount: 100000,
                        expired_at: "2024-07-31",
                        total_quantity: 800,
                        used_quantity: 123,
                        remaining_quantity: 677,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: true,
                        is_popular: false,
                        created_at: "2024-05-10",
                        usage_percentage: 15,
                        days_remaining: 77
                    },
                    {
                        id: 6,
                        code: "FIRSTORDER",
                        name: "Ưu đãi đầu tiên",
                        description: "Giảm 25% cho đơn hàng đầu tiên. Dành cho tất cả khách hàng mới.",
                        discount_type: "percent",
                        discount_value: 25,
                        min_order_amount: 0,
                        max_discount: 100000,
                        expired_at: "2024-12-31",
                        total_quantity: 9999,
                        used_quantity: 3456,
                        remaining_quantity: 6543,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: false,
                        is_popular: true,
                        created_at: "2024-01-01",
                        usage_percentage: 34,
                        days_remaining: 220
                    },
                    {
                        id: 7,
                        code: "BIRTHDAY100K",
                        name: "Sinh nhật rộn ràng",
                        description: "Giảm 100k cho đơn hàng sinh nhật. Áp dụng trong tháng sinh nhật của khách hàng.",
                        discount_type: "cash",
                        discount_value: 100000,
                        min_order_amount: 500000,
                        max_discount: 100000,
                        expired_at: "2024-12-25",
                        total_quantity: 100,
                        used_quantity: 23,
                        remaining_quantity: 77,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: false,
                        is_popular: false,
                        created_at: "2024-04-15",
                        usage_percentage: 23,
                        days_remaining: 210
                    },
                    {
                        id: 8,
                        code: "BREAKFAST20",
                        name: "Bữa sáng dinh dưỡng",
                        description: "Giảm 20% cho đơn hàng buổi sáng. Áp dụng từ 6:00 - 10:00 sáng hàng ngày.",
                        discount_type: "percent",
                        discount_value: 20,
                        min_order_amount: 100000,
                        max_discount: 50000,
                        expired_at: "2024-06-30",
                        total_quantity: 500,
                        used_quantity: 189,
                        remaining_quantity: 311,
                        image_url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop",
                        status: "active",
                        is_featured: true,
                        is_popular: true,
                        created_at: "2024-05-01",
                        usage_percentage: 37,
                        days_remaining: 60
                    }
                ];
                localStorage.setItem('foodgo_vouchers', JSON.stringify(demoVouchers));
            }
            
            // Initialize chatbot history
            if (!localStorage.getItem('foodgo_chat_history')) {
                localStorage.setItem('foodgo_chat_history', JSON.stringify([]));
            }
        }

        // Check authentication
        function checkAuth() {
            const currentUser = JSON.parse(localStorage.getItem('foodgo_current_user') || 'null');
            const notLoggedIn = document.getElementById('not-logged-in');
            const loggedIn = document.getElementById('logged-in');
            const mobileUserInfo = document.getElementById('mobile-user-info');
            const mobileLoginButton = document.getElementById('mobile-login-button');
            
            if (currentUser) {
                notLoggedIn.style.display = 'none';
                loggedIn.style.display = 'block';
                mobileUserInfo.style.display = 'block';
                mobileLoginButton.style.display = 'none';
                
                document.getElementById('user-name').textContent = currentUser.fullName;
                document.getElementById('user-role').textContent = getRoleName(currentUser.role);
                document.getElementById('mobile-user-name').textContent = currentUser.fullName;
                document.getElementById('mobile-user-role').textContent = getRoleName(currentUser.role);
            } else {
                notLoggedIn.style.display = 'block';
                loggedIn.style.display = 'none';
                mobileUserInfo.style.display = 'none';
                mobileLoginButton.style.display = 'block';
            }
            
            updateCartCount();
        }

        // Get role name
        function getRoleName(role) {
            const roles = {
                'customer': 'Khách hàng',
                'staff': 'Nhân viên',
                'admin': 'Quản trị viên'
            };
            return roles[role] || role;
        }

        // Mobile menu toggle
        document.getElementById('mobile-menu-button')?.addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            const searchBar = document.getElementById('mobile-search-bar');
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                searchBar.classList.add('hidden');
            } else {
                menu.classList.add('hidden');
            }
        });

        // Mobile search toggle
        document.getElementById('mobile-search-button')?.addEventListener('click', function() {
            const searchBar = document.getElementById('mobile-search-bar');
            const menu = document.getElementById('mobile-menu');
            
            if (searchBar.classList.contains('hidden')) {
                searchBar.classList.remove('hidden');
                menu.classList.add('hidden');
            } else {
                searchBar.classList.add('hidden');
            }
        });

        // Setup logout
        function setupLogout() {
            const logoutButtons = ['logout-button', 'mobile-logout-button', 'confirm-logout'];
            const cancelButton = document.getElementById('cancel-logout');
            const modal = document.getElementById('logout-modal');
            
            logoutButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function(e) {
                        if (btnId === 'confirm-logout') {
                            performLogout();
                        } else {
                            e.preventDefault();
                            modal.classList.remove('hidden');
                            modal.classList.add('flex');
                        }
                    });
                }
            });
            
            if (cancelButton) {
                cancelButton.addEventListener('click', function() {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });
            }
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            });
        }

        // Perform logout
        function performLogout() {
            localStorage.removeItem('foodgo_current_user');
            document.getElementById('logout-modal').classList.add('hidden');
            showToast('Đăng xuất thành công', 'Bạn đã đăng xuất khỏi tài khoản.');
            
            setTimeout(() => {
                location.reload();
            }, 1500);
        }

        // Update cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('foodgo_cart') || '[]');
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
            return count;
        }

        // Toast notification
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toast-icon');
            document.getElementById('toast-title').textContent = title;
            document.getElementById('toast-message').textContent = message;
            
            // Set icon color based on type
            toastIcon.className = 'h-10 w-10 rounded-full flex items-center justify-center';
            if (type === 'success') {
                toastIcon.classList.add('bg-green-100', 'text-green-600');
                toastIcon.innerHTML = '<span class="material-symbols-outlined">check_circle</span>';
            } else if (type === 'error') {
                toastIcon.classList.add('bg-red-100', 'text-red-600');
                toastIcon.innerHTML = '<span class="material-symbols-outlined">error</span>';
            } else if (type === 'warning') {
                toastIcon.classList.add('bg-yellow-100', 'text-yellow-600');
                toastIcon.innerHTML = '<span class="material-symbols-outlined">warning</span>';
            }
            
            toast.classList.remove('hidden');
            toast.style.animation = 'fadeIn 0.3s ease-in';
            
            setTimeout(hideToast, 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('hidden');
        }

        // Show loading
        function showLoading() {
            document.getElementById('loading-spinner').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-spinner').classList.add('hidden');
        }

        // Calculate days remaining
        function getDaysRemaining(expiredDate) {
            try {
                const today = new Date();
                const expired = new Date(expiredDate);
                
                // Reset time part to compare only dates
                today.setHours(0, 0, 0, 0);
                expired.setHours(0, 0, 0, 0);
                
                const diffTime = expired.getTime() - today.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            } catch (error) {
                console.error('Error calculating days remaining:', error);
                return -999;
            }
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }

        // Load vouchers from database
        async function loadVouchers() {
            showLoading();
            
            try {
                // In a real application, you would fetch from API
                // const result = await fetchAPI('vouchers.php', {
                //     action: 'get_filtered_vouchers',
                //     type: filters.type.join(','),
                //     status: filters.status.join(','),
                //     min_order_value: filters.min_order_value,
                //     sort_by: filters.sort_by,
                //     page: currentPage,
                //     limit: 9
                // });
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Get demo data
                const demoVouchers = JSON.parse(localStorage.getItem('foodgo_vouchers') || '[]');
                
                // Filter demo vouchers based on current filters
                let filteredVouchers = demoVouchers.filter(voucher => {
                    // Type filter
                    if (!filters.type.includes('all') && !filters.type.includes(voucher.discount_type)) {
                        return false;
                    }
                    
                    // Status filter
                    const daysRemaining = getDaysRemaining(voucher.expired_at);
                    const isExpiring = daysRemaining <= 7 && daysRemaining > 0;
                    const isNew = (new Date() - new Date(voucher.created_at)) / (1000 * 60 * 60 * 24) <= 7;
                    
                    if (filters.status.includes('active') && daysRemaining <= 0) return false;
                    if (filters.status.includes('expiring') && !isExpiring) return false;
                    if (filters.status.includes('new') && !isNew) return false;
                    if (filters.status.includes('popular') && !voucher.is_popular) return false;
                    
                    // Min order value filter
                    if (voucher.min_order_amount > filters.min_order_value) return false;
                    
                    return true;
                });
                
                // Sort vouchers
                filteredVouchers.sort((a, b) => {
                    switch(filters.sort_by) {
                        case 'newest': return new Date(b.created_at) - new Date(a.created_at);
                        case 'popular': 
                            if (a.is_popular && !b.is_popular) return -1;
                            if (!a.is_popular && b.is_popular) return 1;
                            return b.used_quantity - a.used_quantity;
                        case 'discount_high': 
                            if (a.discount_type === 'percent' && b.discount_type === 'percent') {
                                return b.discount_value - a.discount_value;
                            }
                            if (a.discount_type === 'cash' && b.discount_type === 'cash') {
                                return b.discount_value - a.discount_value;
                            }
                            return 0;
                        case 'expiring': 
                            const daysA = getDaysRemaining(a.expired_at);
                            const daysB = getDaysRemaining(b.expired_at);
                            if (daysA <= 0 && daysB > 0) return 1;
                            if (daysA > 0 && daysB <= 0) return -1;
                            return daysA - daysB;
                        case 'min_value': return a.min_order_amount - b.min_order_amount;
                        default: return new Date(b.created_at) - new Date(a.created_at);
                    }
                });
                
                hideLoading();
                
                renderVouchers(filteredVouchers);
                totalPages = Math.ceil(filteredVouchers.length / 9);
                document.getElementById('result-count').textContent = `Hiển thị ${filteredVouchers.length} khuyến mãi`;
                updatePagination();
                
            } catch (error) {
                hideLoading();
                console.error('Error loading vouchers:', error);
                showToast('Lỗi', 'Không thể tải danh sách khuyến mãi', 'error');
            }
        }

        // Render vouchers
        function renderVouchers(vouchers) {
            const container = document.getElementById('vouchers-grid');
            
            if (vouchers.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="h-16 w-16 bg-gray-100 dark:bg-[#3d2e1f] text-gray-400 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl">search_off</span>
                        </div>
                        <h4 class="text-lg font-bold mb-2">Không tìm thấy khuyến mãi</h4>
                        <p class="text-[#9c7349]">Hãy thử điều chỉnh bộ lọc hoặc tìm kiếm mã khác</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            vouchers.forEach(voucher => {
                const daysRemaining = getDaysRemaining(voucher.expired_at);
                const isExpiring = daysRemaining <= 7 && daysRemaining > 0;
                const isExpired = daysRemaining <= 0;
                const isNew = (new Date() - new Date(voucher.created_at)) / (1000 * 60 * 60 * 24) <= 7;
                const usagePercent = Math.round((voucher.used_quantity / voucher.total_quantity) * 100);
                const isAlmostUsed = usagePercent >= 90;
                
                // Determine badge color based on discount type
                let badgeColor = 'bg-primary/10 text-primary';
                let badgeText = '';
                
                if (voucher.discount_type === 'percent') {
                    badgeText = `-${voucher.discount_value}%`;
                } else if (voucher.discount_type === 'cash') {
                    badgeText = `-${(voucher.discount_value / 1000).toLocaleString('vi-VN')}K`;
                    badgeColor = 'bg-green-500/10 text-green-500';
                } else if (voucher.discount_type === 'freeship') {
                    badgeText = 'FREE SHIP';
                    badgeColor = 'bg-blue-500/10 text-blue-500';
                } else if (voucher.discount_type === 'combo') {
                    badgeText = 'COMBO';
                    badgeColor = 'bg-purple-500/10 text-purple-500';
                }
                
                html += `
                    <div class="voucher-card bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-3xl overflow-hidden border border-[#f4ede7] dark:border-[#3d2e1f] hover:shadow-xl transition-all duration-300 ${isExpired ? 'opacity-60' : ''}">
                        ${isExpiring ? `
                            <div class="absolute top-3 left-3 z-10">
                                <span class="px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-lg flex items-center gap-1">
                                    <span class="material-symbols-outlined text-xs">schedule</span>
                                    Còn ${daysRemaining} ngày
                                </span>
                            </div>
                        ` : ''}
                        
                        ${isNew && !isExpired ? `
                            <div class="absolute top-3 right-3 z-10">
                                <span class="px-2 py-1 bg-blue-500 text-white text-xs font-bold rounded-lg">MỚI</span>
                            </div>
                        ` : ''}
                        
                        <div class="relative h-40 xs:h-48 md:h-52 overflow-hidden cursor-pointer" onclick="showVoucherDetail(${voucher.id})">
                            <div class="absolute inset-0 bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-4xl md:text-5xl font-black text-primary mb-2">
                                        ${voucher.discount_type === 'percent' ? `${voucher.discount_value}%` : 
                                          voucher.discount_type === 'cash' ? `${(voucher.discount_value / 1000).toLocaleString('vi-VN')}K` :
                                          'FREE'}
                                    </div>
                                    <div class="text-lg font-bold text-primary uppercase tracking-wider">
                                        ${voucher.discount_type === 'percent' ? 'GIẢM GIÁ' : 
                                          voucher.discount_type === 'cash' ? 'GIẢM TIỀN' :
                                          'MIỄN PHÍ SHIP'}
                                    </div>
                                </div>
                            </div>
                            ${isExpired ? `
                                <div class="absolute inset-0 bg-black/60 flex items-center justify-center">
                                    <span class="text-white font-bold text-sm">ĐÃ HẾT HẠN</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="p-4 md:p-5">
                            <div class="flex items-start justify-between gap-2 mb-2">
                                <h3 class="font-bold text-base md:text-lg mb-1 group-hover:text-primary transition-colors truncate" onclick="showVoucherDetail(${voucher.id})" style="cursor: pointer;">
                                    ${voucher.name}
                                </h3>
                                <span class="px-2 py-1 ${badgeColor} rounded-lg text-xs font-bold shrink-0">
                                    ${badgeText}
                                </span>
                            </div>
                            <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl inline-flex items-center gap-2 mb-3">
                                <span class="text-xs font-bold text-[#9c7349]">Mã:</span>
                                <span class="text-sm font-black text-primary tracking-widest uppercase">${voucher.code}</span>
                            </div>
                            <p class="text-[#9c7349] dark:text-gray-400 text-xs mb-3 md:mb-4 line-clamp-2">${voucher.description}</p>
                            
                            <!-- Progress bar -->
                            <div class="mb-4">
                                <div class="flex justify-between text-xs text-[#9c7349] mb-1">
                                    <span>Đã sử dụng: ${voucher.used_quantity}/${voucher.total_quantity}</span>
                                    <span>${usagePercent}%</span>
                                </div>
                                <div class="progress-bar bg-gray-200 dark:bg-[#3d2e1f]">
                                    <div class="progress-fill ${isAlmostUsed ? 'bg-red-500' : 'bg-primary'}" style="width: ${Math.min(usagePercent, 100)}%"></div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-xs text-[#9c7349]">Áp dụng cho đơn từ</span>
                                    <span class="text-sm font-bold text-[#1c140d] dark:text-white">
                                        ${new Intl.NumberFormat('vi-VN').format(voucher.min_order_amount)}đ
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="copyVoucherCode('${voucher.code}', event)" class="h-9 w-9 md:h-10 md:w-10 border-2 border-primary/20 text-primary rounded-xl hover:bg-primary/5 transition-all flex items-center justify-center">
                                        <span class="material-symbols-outlined text-sm">content_copy</span>
                                    </button>
                                    <button onclick="saveVoucher(${voucher.id})" class="h-9 w-9 md:h-10 md:w-10 border-2 border-[#f4ede7] dark:border-[#3d2e1f] text-primary rounded-xl hover:border-primary transition-all flex items-center justify-center group">
                                        <span class="material-symbols-outlined text-sm group-hover:fill-1">favorite</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Show voucher detail
        async function showVoucherDetail(voucherId) {
            currentVoucherId = voucherId;
            
            // Show modal
            document.getElementById('voucher-detail-modal').classList.remove('hidden');
            document.getElementById('voucher-detail-modal').classList.add('flex');
            
            // Show loading in detail modal
            document.getElementById('voucher-detail-content').innerHTML = `
                <div class="text-center py-8">
                    <div class="loading-spinner mx-auto"></div>
                    <p class="mt-4 text-[#9c7349]">Đang tải thông tin...</p>
                </div>
            `;
            
            // Load voucher detail
            showLoading();
            try {
                // In a real application, you would fetch from API
                // const result = await fetchAPI('vouchers.php', { 
                //     action: 'get_voucher_detail', 
                //     voucher_id: voucherId 
                // });
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // Get demo data
                const demoVouchers = JSON.parse(localStorage.getItem('foodgo_vouchers') || '[]');
                const voucher = demoVouchers.find(v => v.id === voucherId) || demoVouchers[0];
                
                hideLoading();
                renderVoucherDetail(voucher);
            } catch (error) {
                hideLoading();
                console.error('Error loading voucher detail:', error);
                showToast('Lỗi', 'Không thể tải thông tin khuyến mãi', 'error');
            }
        }

        // Render voucher detail
        function renderVoucherDetail(voucher) {
            const daysRemaining = getDaysRemaining(voucher.expired_at);
            const isExpiring = daysRemaining <= 7 && daysRemaining > 0;
            const isExpired = daysRemaining <= 0;
            const isNew = (new Date() - new Date(voucher.created_at)) / (1000 * 60 * 60 * 24) <= 7;
            const usagePercent = Math.round((voucher.used_quantity / voucher.total_quantity) * 100);
            const isAlmostUsed = usagePercent >= 90;
            
            let html = `
                <div class="space-y-6">
                    <!-- Voucher Header -->
                    <div class="text-center p-6 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5">
                        <div class="text-5xl md:text-6xl font-black text-primary mb-2">
                            ${voucher.discount_type === 'percent' ? `${voucher.discount_value}%` : 
                              voucher.discount_type === 'cash' ? `${(voucher.discount_value / 1000).toLocaleString('vi-VN')}K` :
                              'FREE SHIP'}
                        </div>
                        <h2 class="text-2xl md:text-3xl font-black mb-3">${voucher.name}</h2>
                        <div class="bg-white dark:bg-[#3d2e1f] px-4 py-2 rounded-xl inline-flex items-center gap-3">
                            <span class="text-sm font-bold text-[#9c7349]">Mã:</span>
                            <span class="text-xl font-black text-primary tracking-widest uppercase">${voucher.code}</span>
                            <button onclick="copyVoucherCode('${voucher.code}', event)" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-[#4d3a27]">
                                <span class="material-symbols-outlined text-primary">content_copy</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Badges -->
                    <div class="flex flex-wrap gap-2">
                        ${isExpiring ? `
                            <span class="px-3 py-1.5 bg-red-500/10 text-red-500 rounded-full text-xs font-bold flex items-center gap-1">
                                <span class="material-symbols-outlined text-xs">schedule</span>
                                Còn ${daysRemaining} ngày
                            </span>
                        ` : ''}
                        
                        ${isNew && !isExpired ? `
                            <span class="px-3 py-1.5 bg-blue-500/10 text-blue-500 rounded-full text-xs font-bold">MỚI</span>
                        ` : ''}
                        
                        ${voucher.is_featured ? `
                            <span class="px-3 py-1.5 bg-primary/10 text-primary rounded-full text-xs font-bold">NỔI BẬT</span>
                        ` : ''}
                        
                        ${voucher.is_popular ? `
                            <span class="px-3 py-1.5 bg-yellow-500/10 text-yellow-500 rounded-full text-xs font-bold">PHỔ BIẾN</span>
                        ` : ''}
                        
                        ${isAlmostUsed ? `
                            <span class="px-3 py-1.5 bg-red-500/10 text-red-500 rounded-full text-xs font-bold">SẮP HẾT</span>
                        ` : ''}
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-2 uppercase tracking-wider">Mô tả</h4>
                        <p class="text-[#9c7349] dark:text-gray-300 leading-relaxed">${voucher.description}</p>
                    </div>
                    
                    <!-- Details Grid -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-3 rounded-xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg">sell</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Giảm giá</span>
                            </div>
                            <p class="font-bold text-sm md:text-base">
                                ${voucher.discount_type === 'percent' ? `${voucher.discount_value}%` : 
                                  voucher.discount_type === 'cash' ? `${new Intl.NumberFormat('vi-VN').format(voucher.discount_value)}đ` :
                                  'Miễn phí vận chuyển'}
                                ${voucher.max_discount ? `(Tối đa ${new Intl.NumberFormat('vi-VN').format(voucher.max_discount)}đ)` : ''}
                            </p>
                        </div>
                        <div class="p-3 rounded-xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg">shopping_cart</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Đơn tối thiểu</span>
                            </div>
                            <p class="font-bold text-sm md:text-base">${new Intl.NumberFormat('vi-VN').format(voucher.min_order_amount)}đ</p>
                        </div>
                        <div class="p-3 rounded-xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg">event</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Hạn sử dụng</span>
                            </div>
                            <p class="font-bold text-sm md:text-base ${isExpired ? 'text-red-500' : ''}">${formatDate(voucher.expired_at)}</p>
                        </div>
                        <div class="p-3 rounded-xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg">inventory_2</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Số lượng</span>
                            </div>
                            <p class="font-bold text-sm md:text-base">${voucher.remaining_quantity}/${voucher.total_quantity}</p>
                        </div>
                    </div>
                    
                    <!-- Progress bar -->
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="font-bold">Tiến độ sử dụng</span>
                            <span class="text-[#9c7349]">${usagePercent}%</span>
                        </div>
                        <div class="progress-bar bg-gray-200 dark:bg-[#3d2e1f]">
                            <div class="progress-fill ${isAlmostUsed ? 'bg-red-500' : 'bg-primary'}" style="width: ${Math.min(usagePercent, 100)}%"></div>
                        </div>
                        <p class="text-xs text-[#9c7349] mt-1">${voucher.used_quantity} người đã sử dụng • Còn ${voucher.remaining_quantity} mã</p>
                    </div>
                    
                    <!-- Usage Instructions -->
                    <div>
                        <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-2 uppercase tracking-wider">Hướng dẫn sử dụng</h4>
                        <ul class="text-sm text-[#9c7349] dark:text-gray-300 space-y-2">
                            <li class="flex items-start gap-2">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <span>Thêm sản phẩm vào giỏ hàng</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <span>Nhập mã <strong class="text-primary">${voucher.code}</strong> tại bước thanh toán</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <span>Mã sẽ tự động áp dụng nếu đơn hàng đạt điều kiện</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="material-symbols-outlined text-primary text-sm mt-0.5">check_circle</span>
                                <span>Mỗi mã chỉ sử dụng được 1 lần</span>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                        <button onclick="useVoucherNow(${voucher.id})" class="flex-1 h-12 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all flex items-center justify-center gap-2 ${isExpired ? 'opacity-50 cursor-not-allowed' : ''}" ${isExpired ? 'disabled' : ''}>
                            <span class="material-symbols-outlined">shopping_cart</span>
                            Sử dụng ngay
                        </button>
                        <button onclick="copyVoucherCode('${voucher.code}', event)" class="h-12 px-6 border-2 border-primary/20 text-primary font-bold rounded-xl hover:bg-primary/5 transition-all flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined">content_copy</span>
                            Sao chép mã
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('voucher-detail-content').innerHTML = html;
        }

        // Close voucher modal
        function closeVoucherModal() {
            document.getElementById('voucher-detail-modal').classList.add('hidden');
            document.getElementById('voucher-detail-modal').classList.remove('flex');
        }

        // Copy voucher code
        function copyVoucherCode(code, event = null) {
            if (event) event.stopPropagation();
            
            navigator.clipboard.writeText(code).then(() => {
                // Add animation to button
                const button = event?.target?.closest('button');
                if (button) {
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<span class="material-symbols-outlined">check</span>';
                    button.style.backgroundColor = '#10b981';
                    button.style.color = 'white';
                    button.style.borderColor = '#10b981';
                    
                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.style.backgroundColor = '';
                        button.style.color = '';
                        button.style.borderColor = '';
                    }, 2000);
                }
                
                showToast('Đã sao chép', `Mã ${code} đã được sao chép vào clipboard`);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showToast('Lỗi', 'Không thể sao chép mã', 'error');
            });
        }

        // Save voucher to favorites
        async function saveVoucher(voucherId) {
            const currentUser = JSON.parse(localStorage.getItem('foodgo_current_user') || 'null');
            
            if (!currentUser) {
                showToast('Vui lòng đăng nhập', 'Bạn cần đăng nhập để lưu voucher', 'warning');
                setTimeout(() => {
                    window.location.href = 'Đăng nhập.html';
                }, 1500);
                return;
            }
            
            try {
                // In a real application, you would call API
                // const result = await fetch(`${API_BASE_URL}/vouchers.php`, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         action: 'save_voucher',
                //         user_id: currentUser.id,
                //         voucher_id: voucherId
                //     })
                // });
                
                // For demo, just show toast
                const demoVouchers = JSON.parse(localStorage.getItem('foodgo_vouchers') || '[]');
                const voucher = demoVouchers.find(v => v.id === voucherId);
                
                if (voucher) {
                    showToast('Đã lưu', `Đã lưu "${voucher.name}" vào danh sách yêu thích`);
                    
                    // Button animation
                    const button = event?.target?.closest('button');
                    if (button) {
                        button.innerHTML = '<span class="material-symbols-outlined fill-1">favorite</span>';
                        button.style.color = '#ef4444';
                        
                        setTimeout(() => {
                            button.innerHTML = '<span class="material-symbols-outlined">favorite</span>';
                            button.style.color = '';
                        }, 2000);
                    }
                }
            } catch (error) {
                console.error('Error saving voucher:', error);
                showToast('Lỗi', 'Không thể lưu voucher', 'error');
            }
        }

        // Use voucher now
        async function useVoucherNow(voucherId) {
            const currentUser = JSON.parse(localStorage.getItem('foodgo_current_user') || 'null');
            
            if (!currentUser) {
                showToast('Vui lòng đăng nhập', 'Bạn cần đăng nhập để sử dụng voucher', 'warning');
                setTimeout(() => {
                    window.location.href = 'Đăng nhập.html';
                }, 1500);
                return;
            }
            
            try {
                // In a real application, you would call API
                // const result = await fetch(`${API_BASE_URL}/vouchers.php`, {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({
                //         action: 'use_voucher',
                //         user_id: currentUser.id,
                //         voucher_id: voucherId
                //     })
                // });
                
                // For demo, just show toast and redirect
                const demoVouchers = JSON.parse(localStorage.getItem('foodgo_vouchers') || '[]');
                const voucher = demoVouchers.find(v => v.id === voucherId);
                
                if (voucher) {
                    showToast('Thành công', `Mã ${voucher.code} đã được áp dụng`);
                    closeVoucherModal();
                    
                    // Redirect to cart page after 1.5 seconds
                    setTimeout(() => {
                        window.location.href = 'Giỏ hàng & Thanh toán.html';
                    }, 1500);
                }
            } catch (error) {
                console.error('Error using voucher:', error);
                showToast('Lỗi', 'Không thể sử dụng voucher', 'error');
            }
        }

        // Update pagination
        function updatePagination() {
            const paginationNumbers = document.getElementById('pagination-numbers');
            let html = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="w-10 h-10 rounded-xl bg-primary text-white font-bold flex items-center justify-center">${i}</button>`;
                } else {
                    html += `<button class="page-number w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors" data-page="${i}">${i}</button>`;
                }
            }
            
            paginationNumbers.innerHTML = html;
            
            // Add event listeners to page numbers
            document.querySelectorAll('.page-number').forEach(button => {
                button.addEventListener('click', function() {
                    currentPage = parseInt(this.dataset.page);
                    loadVouchers();
                });
            });
            
            // Update prev/next buttons
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
        }

        // AI Chatbot Functions
        function initChatbot() {
            // Chatbot launcher button
            const chatbotLauncher = document.getElementById('chatbot-launcher');
            const chatbotWindow = document.getElementById('chatbot-window');
            const closeChatbot = document.getElementById('close-chatbot');
            const minimizeChatbot = document.getElementById('minimize-chatbot');
            const mobileChatbotWindow = document.getElementById('mobile-chatbot-window');
            const mobileChatbotBackdrop = document.getElementById('mobile-chatbot-backdrop');
            const closeMobileChatbot = document.getElementById('close-mobile-chatbot');
            
            // Load chat history
            loadChatHistory();
            
            // Toggle chatbot window
            chatbotLauncher.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (window.innerWidth >= 768) {
                    // Desktop
                    if (chatbotWindow.classList.contains('hidden')) {
                        chatbotWindow.classList.remove('hidden');
                        isChatbotOpen = true;
                        clearUnreadMessages();
                    } else {
                        chatbotWindow.classList.add('hidden');
                        isChatbotOpen = false;
                    }
                } else {
                    // Mobile
                    mobileChatbotWindow.classList.remove('hidden');
                }
            });
            
            // Close chatbot
            closeChatbot.addEventListener('click', function() {
                chatbotWindow.classList.add('hidden');
                isChatbotOpen = false;
                saveChatHistory();
            });
            
            // Minimize chatbot
            minimizeChatbot.addEventListener('click', function() {
                chatbotWindow.classList.add('hidden');
                isChatbotOpen = false;
                saveChatHistory();
            });
            
            // Close mobile chatbot
            closeMobileChatbot.addEventListener('click', function() {
                mobileChatbotWindow.classList.add('hidden');
                saveChatHistory();
            });
            
            // Close mobile chatbot when clicking backdrop
            mobileChatbotBackdrop.addEventListener('click', function() {
                mobileChatbotWindow.classList.add('hidden');
                saveChatHistory();
            });
            
            // Close chatbot when clicking outside
            document.addEventListener('click', function(e) {
                if (!chatbotWindow.contains(e.target) && 
                    !chatbotLauncher.contains(e.target) && 
                    !chatbotWindow.classList.contains('hidden')) {
                    chatbotWindow.classList.add('hidden');
                    isChatbotOpen = false;
                    saveChatHistory();
                }
            });
            
            // Send message functionality
            const sendMessageBtn = document.getElementById('send-message');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotMessages = document.getElementById('chatbot-messages');
            
            const sendMobileMessageBtn = document.getElementById('send-mobile-message');
            const mobileChatbotInput = document.getElementById('mobile-chatbot-input');
            const mobileChatbotMessages = document.getElementById('mobile-chatbot-messages');
            
            // Quick suggestion buttons
            document.querySelectorAll('.quick-suggestion-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const suggestion = this.textContent.trim();
                    chatbotInput.value = suggestion;
                    sendMessageHandler(chatbotInput, 'desktop');
                });
            });
            
            document.querySelectorAll('.mobile-quick-suggestion-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const suggestion = this.textContent.trim();
                    mobileChatbotInput.value = suggestion;
                    sendMessageHandler(mobileChatbotInput, 'mobile');
                });
            });
            
            function addMessage(message, isUser = false, target = 'desktop') {
                const messagesContainer = target === 'desktop' ? chatbotMessages : mobileChatbotMessages;
                const messageClass = isUser ? 'ml-auto bg-primary text-white rounded-2xl rounded-br-none' : 'bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none';
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `chatbot-message ${isUser ? 'ml-auto' : ''}`;
                messageDiv.innerHTML = `
                    <div class="flex items-end gap-2 ${isUser ? 'flex-row-reverse' : ''}">
                        ${!isUser ? `
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                            </div>
                        ` : ''}
                        <div class="${messageClass} px-4 py-3 max-w-xs">
                            <p class="text-sm whitespace-pre-line">${message}</p>
                        </div>
                        ${isUser ? `
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">person</span>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Save to history
                saveToChatHistory(message, isUser);
            }
            
            function addTypingIndicator(target = 'desktop') {
                const messagesContainer = target === 'desktop' ? chatbotMessages : mobileChatbotMessages;
                
                const typingDiv = document.createElement('div');
                typingDiv.className = 'chatbot-message';
                typingDiv.innerHTML = `
                    <div class="flex items-end gap-2">
                        <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                            <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                        </div>
                        <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                return typingDiv;
            }
            
            function removeTypingIndicator(typingDiv) {
                typingDiv.remove();
            }
            
            async function processUserMessage(message, target = 'desktop') {
                // Add user message
                addMessage(message, true, target);
                
                // Add typing indicator
                const typingDiv = addTypingIndicator(target);
                
                try {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Remove typing indicator
                    removeTypingIndicator(typingDiv);
                    
                    // Generate AI response
                    const response = generateAIResponse(message);
                    
                    // Add AI response
                    addMessage(response, false, target);
                    
                    // If chatbot is closed, show notification
                    if (!isChatbotOpen && target === 'desktop') {
                        addUnreadMessage();
                    }
                } catch (error) {
                    removeTypingIndicator(typingDiv);
                    addMessage('Xin lỗi, tôi gặp sự cố khi xử lý yêu cầu của bạn. Vui lòng thử lại sau.', false, target);
                }
            }
            
            function generateAIResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Check for specific keywords about vouchers
                if (lowerMessage.includes('giảm giá cao nhất') || lowerMessage.includes('discount high')) {
                    return `💰 **Giảm giá cao nhất hiện có:**\n\n• **WEEKEND30** - Giảm 30% (tối đa 100K)\n• **SUMMER24** - Giảm 20% (tối đa 50K)\n• **FIRSTORDER** - Giảm 25% (tối đa 100K)\n\nBạn có thể tìm thấy các mã này trong danh sách khuyến mãi!`;
                } else if (lowerMessage.includes('sắp hết hạn') || lowerMessage.includes('expiring')) {
                    return `⏰ **Các mã sắp hết hạn:**\n\n• **FAMILY15** - Còn 15 ngày\n• **HELLOFOOD** - Còn 45 ngày\n• **FREESHIP** - Còn 50 ngày\n\nHãy sử dụng ngay để không bỏ lỡ ưu đãi!`;
                } else if (lowerMessage.includes('miễn phí ship') || lowerMessage.includes('free ship') || lowerMessage.includes('freeship')) {
                    return `🚚 **Mã miễn phí ship:**\n\n• **FREESHIP** - Miễn phí ship đơn từ 100K\n• **Địa chỉ áp dụng:** Trong phạm vi 5km\n• **Thời gian:** Áp dụng mọi ngày trong tuần\n\nLưu ý: Mỗi đơn hàng chỉ áp dụng 1 mã giảm giá!`;
                } else if (lowerMessage.includes('cách sử dụng') || lowerMessage.includes('hướng dẫn') || lowerMessage.includes('sử dụng mã')) {
                    return `📝 **Hướng dẫn sử dụng mã giảm giá:**\n\n1. **Chọn món** từ thực đơn\n2. **Thêm vào giỏ hàng**\n3. **Vào giỏ hàng & thanh toán**\n4. **Nhập mã** vào ô "Mã khuyến mãi"\n5. **Nhấn "Áp dụng"**\n6. **Hoàn tất đơn hàng**\n\n💡 **Lưu ý:**\n• Mỗi mã chỉ dùng 1 lần\n• Có thể kết hợp với tích điểm\n• Không áp dụng đồng thời nhiều mã`;
                } else if (lowerMessage.includes('điều kiện') || lowerMessage.includes('condition') || lowerMessage.includes('áp dụng')) {
                    return `📋 **Điều kiện sử dụng chung:**\n\n• **Đơn tối thiểu:** Tuỳ từng mã (0đ - 500K)\n• **Số lượng có hạn:** Mỗi mã có giới hạn số lượng\n• **Thời hạn:** Mỗi mã có thời hạn riêng\n• **1 khách/1 mã:** Mỗi tài khoản dùng 1 lần\n• **Không hoàn tiền:** Không hoàn tiền thừa\n\nKiểm tra chi tiết trong thông tin từng mã!`;
                } else if (lowerMessage.includes('combo') || lowerMessage.includes('tiết kiệm')) {
                    return `🎯 **Combo & gói tiết kiệm:**\n\n• **FAMILY15** - Giảm 15% combo gia đình\n• **WEEKEND30** - Giảm 30% cuối tuần\n• **Combo tự chọn** - Tự chọn món, giảm thêm 10%\n\n💡 **Mẹo:** Đặt combo để tiết kiệm hơn!`;
                } else if (lowerMessage.includes('tìm mã') || lowerMessage.includes('search voucher') || lowerMessage.includes('khuyến mãi')) {
                    return `🔍 **Cách tìm mã phù hợp:**\n\n1. **Dùng bộ lọc** bên trái\n2. **Tìm theo loại** (% , tiền mặt, freeship)\n3. **Lọc theo trạng thái** (mới, sắp hết hạn)\n4. **Sắp xếp** theo nhu cầu\n5. **Nhấp vào mã** để xem chi tiết\n\nBạn cần tôi tìm mã theo tiêu chí cụ thể nào?`;
                } else if (lowerMessage.includes('cảm ơn') || lowerMessage.includes('thanks') || lowerMessage.includes('thank you')) {
                    return `😊 **Không có gì!** Rất vui được giúp bạn.\n\nNếu bạn có thắc mắc gì về khuyến mãi, cứ hỏi tôi nhé!\n\nChúc bạn tìm được mã ưng ý! 🎁`;
                } else if (lowerMessage.includes('chào') || lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('xin chào')) {
                    return `👋 **Xin chào!** Tôi là FoodGo Assistant chuyên về khuyến mãi. 😊\n\nTôi có thể giúp bạn:\n• 🎯 Tìm mã giảm giá phù hợp\n• 💰 So sánh các ưu đãi\n• ⏰ Thông báo mã sắp hết hạn\n• 📝 Hướng dẫn sử dụng mã\n• 🔍 Tư vấn chọn mã tốt nhất\n\nBạn cần hỗ trợ gì về khuyến mãi?`;
                } else {
                    // Default response with suggestions
                    return `🤖 **Tôi có thể giúp bạn tìm mã giảm giá phù hợp!**\n\nHãy cho tôi biết bạn cần:\n\n1. **Loại giảm giá nào?** (% , tiền mặt, freeship)\n2. **Đơn hàng của bạn** khoảng bao nhiêu?\n3. **Bạn ưu tiên** giảm nhiều hay dễ áp dụng?\n\nHoặc bạn có thể hỏi về:\n• 🎁 Mã giảm giá cao nhất\n• ⏰ Mã sắp hết hạn\n• 🚚 Mã miễn phí ship\n• 📋 Điều kiện sử dụng\n• 💡 Mẹo tiết kiệm\n\nTôi luôn sẵn sàng hỗ trợ bạn! 😊`;
                }
            }
            
            // Event listeners for sending messages
            function sendMessageHandler(input, target) {
                const message = input.value.trim();
                if (message) {
                    processUserMessage(message, target);
                    input.value = '';
                    
                    // Focus back to input
                    setTimeout(() => {
                        input.focus();
                    }, 100);
                }
            }
            
            if (sendMessageBtn && chatbotInput) {
                sendMessageBtn.addEventListener('click', () => sendMessageHandler(chatbotInput, 'desktop'));
                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessageHandler(chatbotInput, 'desktop');
                    }
                });
            }
            
            if (sendMobileMessageBtn && mobileChatbotInput) {
                sendMobileMessageBtn.addEventListener('click', () => sendMessageHandler(mobileChatbotInput, 'mobile'));
                mobileChatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessageHandler(mobileChatbotInput, 'mobile');
                    }
                });
            }
            
            // Auto-open chatbot on first visit
            const hasVisited = localStorage.getItem('foodgo_chatbot_visited_vouchers');
            if (!hasVisited && window.innerWidth >= 768) {
                setTimeout(() => {
                    chatbotWindow.classList.remove('hidden');
                    isChatbotOpen = true;
                    localStorage.setItem('foodgo_chatbot_visited_vouchers', 'true');
                }, 3000);
            }
        }
        
        // Chat history functions
        function saveToChatHistory(message, isUser) {
            const history = JSON.parse(localStorage.getItem('foodgo_chat_history') || '[]');
            history.push({
                message: message,
                isUser: isUser,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 50 messages
            if (history.length > 50) {
                history.splice(0, history.length - 50);
            }
            
            localStorage.setItem('foodgo_chat_history', JSON.stringify(history));
        }
        
        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem('foodgo_chat_history') || '[]');
            
            // If no history, add welcome message
            if (history.length === 0) {
                const welcomeMessage = "Xin chào! Tôi là FoodGo Assistant. Tôi có thể giúp bạn tìm mã giảm giá phù hợp với nhu cầu của bạn!";
                saveToChatHistory(welcomeMessage, false);
                
                // Add to chat windows
                const chatbotMessages = document.getElementById('chatbot-messages');
                const mobileChatbotMessages = document.getElementById('mobile-chatbot-messages');
                
                if (chatbotMessages) {
                    chatbotMessages.innerHTML = `
                        <div class="chatbot-message">
                            <div class="flex items-end gap-2">
                                <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                    <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                                </div>
                                <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                    <p class="text-sm">${welcomeMessage}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (mobileChatbotMessages) {
                    mobileChatbotMessages.innerHTML = `
                        <div class="chatbot-message">
                            <div class="flex items-end gap-2">
                                <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                    <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                                </div>
                                <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                    <p class="text-sm">${welcomeMessage}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        function saveChatHistory() {
            // This would save the current chat state
            // For now, we rely on the incremental saving in saveToChatHistory
        }
        
        function addUnreadMessage() {
            unreadMessages++;
            const notification = document.getElementById('chat-notification');
            if (notification) {
                notification.textContent = unreadMessages;
                notification.classList.remove('hidden');
                
                // Add animation to launcher
                const launcher = document.getElementById('chatbot-launcher');
                launcher.classList.add('chatbot-launcher');
            }
        }
        
        function clearUnreadMessages() {
            unreadMessages = 0;
            const notification = document.getElementById('chat-notification');
            if (notification) {
                notification.classList.add('hidden');
                
                // Remove animation from launcher
                const launcher = document.getElementById('chatbot-launcher');
                launcher.classList.remove('chatbot-launcher');
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initDemoData();
            checkAuth();
            setupLogout();
            loadVouchers();
            initChatbot();
            
            // Type filter checkboxes
            document.querySelectorAll('.type-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const label = this.closest('label');
                    const type = label.dataset.type;
                    
                    if (type === "all") {
                        // If "All" is checked, uncheck others
                        if (this.checked) {
                            document.querySelectorAll('.type-checkbox:not([data-type="all"])').forEach(cb => {
                                cb.checked = false;
                            });
                            filters.type = ['all'];
                        }
                    } else {
                        // If other type is checked, uncheck "All"
                        if (this.checked) {
                            document.querySelector('[data-type="all"] .type-checkbox').checked = false;
                            filters.type = filters.type.filter(t => t !== 'all');
                            filters.type.push(type);
                        } else {
                            filters.type = filters.type.filter(t => t !== type);
                            // If no type is selected, check "All"
                            if (filters.type.length === 0) {
                                document.querySelector('[data-type="all"] .type-checkbox').checked = true;
                                filters.type = ['all'];
                            }
                        }
                    }
                });
            });
            
            // Status filter checkboxes
            document.querySelectorAll('.status-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const status = this.dataset.status;
                    
                    if (this.checked) {
                        filters.status.push(status);
                    } else {
                        filters.status = filters.status.filter(s => s !== status);
                    }
                });
            });
            
            // Min value range slider
            const minValueRange = document.getElementById('min-value-range');
            const currentMinValue = document.getElementById('current-min-value');
            
            if (minValueRange) {
                minValueRange.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    currentMinValue.textContent = new Intl.NumberFormat('vi-VN').format(value) + 'đ';
                    filters.min_order_value = value;
                });
            }
            
            // Sort select
            const sortSelect = document.getElementById('sort-select');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    filters.sort_by = this.value;
                    currentPage = 1;
                    loadVouchers();
                });
            }
            
            // Apply filters button
            const applyFiltersBtn = document.getElementById('apply-filters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function() {
                    currentPage = 1;
                    loadVouchers();
                });
            }
            
            // Clear filters button
            const clearFiltersBtn = document.getElementById('clear-filters');
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', function() {
                    // Reset all filters
                    filters = {
                        type: ['all'],
                        status: ['active'],
                        min_order_value: 100000,
                        sort_by: 'newest'
                    };
                    
                    // Reset UI
                    document.querySelector('[data-type="all"] .type-checkbox').checked = true;
                    document.querySelectorAll('.type-checkbox:not([data-type="all"])').forEach(cb => {
                        cb.checked = false;
                    });
                    
                    document.querySelector('[data-status="active"] .status-checkbox').checked = true;
                    document.querySelectorAll('.status-checkbox:not([data-status="active"])').forEach(cb => {
                        cb.checked = false;
                    });
                    
                    minValueRange.value = 100000;
                    currentMinValue.textContent = '100.000đ';
                    
                    sortSelect.value = 'newest';
                    
                    currentPage = 1;
                    loadVouchers();
                });
            }
            
            // Pagination buttons
            document.getElementById('prev-page')?.addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    loadVouchers();
                }
            });
            
            document.getElementById('next-page')?.addEventListener('click', function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadVouchers();
                }
            });
            
            // Search functionality
            const searchInput = document.getElementById('search-input');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            
            function handleSearch() {
                const searchTerm = searchInput?.value || mobileSearchInput?.value || '';
                if (searchTerm.length >= 2) {
                    // You would typically call an API endpoint to search vouchers
                    showToast('Tìm kiếm', `Đang tìm kiếm: "${searchTerm}"`);
                    
                    // For demo, filter existing vouchers
                    const demoVouchers = JSON.parse(localStorage.getItem('foodgo_vouchers') || '[]');
                    const filtered = demoVouchers.filter(voucher => 
                        voucher.code.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        voucher.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        voucher.description.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    
                    renderVouchers(filtered);
                    document.getElementById('result-count').textContent = `Tìm thấy ${filtered.length} kết quả cho "${searchTerm}"`;
                } else if (searchTerm.length === 0) {
                    // Reset to all vouchers
                    loadVouchers();
                }
            }
            
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        handleSearch();
                    }
                });
                
                // Debounced search
                let searchTimer;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimer);
                    searchTimer = setTimeout(handleSearch, 500);
                });
            }
            
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        handleSearch();
                    }
                });
                
                // Debounced search
                let mobileSearchTimer;
                mobileSearchInput.addEventListener('input', function() {
                    clearTimeout(mobileSearchTimer);
                    mobileSearchTimer = setTimeout(handleSearch, 500);
                });
            }
            
            // Close voucher modal when clicking outside
            const voucherModal = document.getElementById('voucher-detail-modal');
            if (voucherModal) {
                voucherModal.addEventListener('click', function(e) {
                    if (e.target === voucherModal) {
                        closeVoucherModal();
                    }
                });
            }
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileSearchBar = document.getElementById('mobile-search-bar');
                const mobileSearchButton = document.getElementById('mobile-search-button');
                
                if (mobileMenu && mobileMenuButton) {
                    if (!mobileMenu.contains(e.target) && 
                        !mobileMenuButton.contains(e.target) && 
                        !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
                
                if (mobileSearchBar && mobileSearchButton) {
                    if (!mobileSearchBar.contains(e.target) && 
                        !mobileSearchButton.contains(e.target) && 
                        !mobileSearchBar.classList.contains('hidden')) {
                        mobileSearchBar.classList.add('hidden');
                    }
                }
            });
        });
        
        // Responsive adjustments on resize
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                document.getElementById('mobile-menu')?.classList.add('hidden');
                document.getElementById('mobile-search-bar')?.classList.add('hidden');
            }
        });
    </script>
</body>
</html>