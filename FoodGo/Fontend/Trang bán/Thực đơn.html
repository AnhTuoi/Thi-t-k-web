<!DOCTYPE html>
<html class="light" lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Thực đơn - FoodGo</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f48c25",
                        "background-light": "#f8f7f5",
                        "background-dark": "#221910",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "3xl": "1.5rem",
                        "full": "9999px"
                    },
                    screens: {
                        'xs': '475px',
                        '3xl': '1920px',
                    }
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: "Plus Jakarta Sans", sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-outlined.fill {
            font-variation-settings: 'FILL' 1;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .menu-item {
            transition: all 0.2s ease;
        }
        .menu-item:hover {
            transform: translateY(-2px);
        }
        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #f48c25;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #f48c25;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .chatbot-message {
            max-width: 85%;
            word-wrap: break-word;
        }
        .typing-indicator {
            display: inline-block;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #f48c25;
            margin: 0 2px;
            opacity: 0.4;
        }
        .typing-indicator span:nth-child(1) { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(2) { animation: bounce 1.4s infinite 0.2s ease-in-out both; }
        .typing-indicator span:nth-child(3) { animation: bounce 1.4s infinite 0.4s ease-in-out both; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }
        .chatbot-launcher {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 140, 37, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 140, 37, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 140, 37, 0); }
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#1c140d] dark:text-[#fcfaf8] min-h-screen">
    <div class="layout-container flex flex-col items-center">
        <!-- Header -->
        <header class="w-full sticky top-0 z-50 bg-white/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-[#f4ede7] dark:border-[#3d2e1f] px-4 md:px-6 lg:px-8 xl:px-20 py-3">
            <div class="max-w-[1200px] mx-auto flex items-center justify-between gap-4 md:gap-8">
                <!-- Logo -->
                <a class="flex items-center gap-2 text-primary shrink-0" href="Trang chủ.html">
                    <span class="material-symbols-outlined text-3xl md:text-4xl font-bold">fastfood</span>
                    <h2 class="text-xl md:text-2xl font-black tracking-tighter">FoodGo</h2>
                </a>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="lg:hidden p-2 rounded-xl bg-[#f4ede7] dark:bg-[#3d2e1f]">
                    <span class="material-symbols-outlined text-2xl">menu</span>
                </button>
                
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex items-center gap-6 xl:gap-8 shrink-0">
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors menu-item" href="Trang chủ.html">Trang chủ</a>
                    <a class="text-sm font-bold text-primary transition-colors menu-item" href="Thực đơn.html">Thực đơn</a>
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors menu-item" href="Khuyến mãi.html">Khuyến mãi</a>
                    <a class="text-sm font-bold text-[#9c7349] dark:text-gray-300 hover:text-primary transition-colors menu-item" href="Đơn hàng.html">Đơn hàng</a>
                </nav>
                
                <!-- Search Bar (Desktop) -->
                <div class="hidden md:flex flex-1 max-w-md mx-4">
                    <label class="relative w-full">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-[#9c7349]">
                            <span class="material-symbols-outlined text-xl">search</span>
                        </span>
                        <input id="search-input" class="w-full h-10 md:h-11 pl-10 pr-4 rounded-2xl border-none bg-[#f4ede7] dark:bg-[#3d2e1f] text-[#1c140d] dark:text-white placeholder:text-[#9c7349] focus:ring-2 focus:ring-primary/50 transition-all text-sm" 
                               placeholder="Tìm kiếm món ăn..." type="text"/>
                    </label>
                </div>
                
                <!-- User Actions -->
                <div class="flex items-center gap-3 md:gap-4 shrink-0">
                    <!-- Search Button (Mobile) -->
                    <button id="mobile-search-button" class="md:hidden p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all">
                        <span class="material-symbols-outlined text-2xl">search</span>
                    </button>
                    
                    <!-- Auth Section -->
                    <div id="auth-section">
                        <!-- Not logged in -->
                        <div id="not-logged-in" style="display: none;">
                            <div class="flex items-center gap-2">
                                <a href="Đăng nhập.html" class="px-4 md:px-6 py-2 md:py-2.5 bg-primary text-white font-bold rounded-2xl hover:opacity-90 transition-all text-sm whitespace-nowrap">
                                    Đăng nhập
                                </a>
                            </div>
                        </div>
                        
                        <!-- Logged in -->
                        <div id="logged-in" style="display: none;">
                            <div class="flex items-center gap-2 md:gap-3">
                                <!-- User Info (Desktop) -->
                                <div class="hidden md:block text-right">
                                    <p class="text-sm font-bold truncate max-w-[120px]" id="user-name"></p>
                                    <p class="text-[10px] text-[#9c7349] truncate max-w-[120px]" id="user-role"></p>
                                </div>
                                
                                <!-- User Avatar -->
                                <div class="h-9 md:h-10 w-9 md:w-10 rounded-2xl bg-cover bg-center border-2 border-primary cursor-pointer hover:scale-105 transition-transform" 
                                     style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD5QyJdrgQc8EU6pqDDaTBolO1VlDlv6lM8W2XV1DfKW4a5PlcqAbGalkVd2R5tSpPt995mjv7mrHl-CbBn8v1DFbLCTf_OXGHrYxelVSZPnRc9GwzER6YHTfHVgz8FOOLJtzUXlcTs-Ohiq-FbZN3MOYmblmy5AiIh0jZq_KhWiEuCqRq1UOXjoyuOyasYqgDUu4FSlFWDRS8FWTie8S6FNhxcsTx5nj8MIEdRXRnvlOFI9qMcjFUC1jM6NQ0RgNfy0VOZHlmNrGI");'>
                                </div>
                                
                                <!-- Logout Button -->
                                <button id="logout-button" class="p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all">
                                    <span class="material-symbols-outlined text-xl">logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cart & Notifications -->
                    <div class="flex items-center gap-1 md:gap-2">
                        <a href="Giỏ hàng & Thanh toán.html" class="relative p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all group">
                            <span class="material-symbols-outlined text-2xl group-hover:text-primary transition-colors">shopping_cart</span>
                            <span id="cart-count" class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910]">0</span>
                        </a>
                        <a href="Thông báo.html" class="p-2 md:p-2.5 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/20 transition-all group relative">
                            <span class="material-symbols-outlined text-2xl group-hover:text-primary transition-colors">notifications</span>
                            <span class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910]">3</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div id="mobile-search-bar" class="md:hidden mt-3 hidden">
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-[#9c7349]">
                        <span class="material-symbols-outlined text-xl">search</span>
                    </span>
                    <input id="mobile-search-input" class="w-full h-11 pl-10 pr-4 rounded-2xl border-none bg-[#f4ede7] dark:bg-[#3d2e1f] text-[#1c140d] dark:text-white placeholder:text-[#9c7349] focus:ring-2 focus:ring-primary/50 transition-all text-sm" 
                           placeholder="Tìm kiếm món ăn..." type="text"/>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="lg:hidden mt-3 hidden bg-white dark:bg-[#2a2015] rounded-2xl border border-[#f4ede7] dark:border-[#3d2e1f] p-4">
                <nav class="space-y-3">
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Trang chủ.html">
                        <span class="material-symbols-outlined">home</span>
                        Trang chủ
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-primary bg-primary/10 rounded-xl" href="Thực đơn.html">
                        <span class="material-symbols-outlined">restaurant_menu</span>
                        Thực đơn
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Khuyến mãi.html">
                        <span class="material-symbols-outlined">redeem</span>
                        Khuyến mãi
                    </a>
                    <a class="flex items-center gap-3 px-4 py-3 text-sm font-bold text-[#9c7349] hover:text-primary hover:bg-gray-50 dark:hover:bg-[#3d2e1f] rounded-xl transition-colors" href="Đơn hàng.html">
                        <span class="material-symbols-outlined">receipt_long</span>
                        Đơn hàng
                    </a>
                    
                    <!-- Mobile User Info -->
                    <div id="mobile-user-info" class="pt-4 border-t border-[#f4ede7] dark:border-[#3d2e1f] hidden">
                        <div class="flex items-center gap-3 px-4 py-3">
                            <div class="h-10 w-10 rounded-xl bg-cover bg-center border-2 border-primary" 
                                 style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuD5QyJdrgQc8EU6pqDDaTBolO1VlDlv6lM8W2XV1DfKW4a5PlcqAbGalkVd2R5tSpPt995mjv7mrHl-CbBn8v1DFbLCTf_OXGHrYxelVSZPnRc9GwzER6YHTfHVgz8FOOLJtzUXlcTs-Ohiq-FbZN3MOYmblmy5AiIh0jZq_KhWiEuCqRq1UOXjoyuOyasYqgDUu4FSlFWDRS8FWTie8S6FNhxcasTx5nj8MIEdRXRnvlOFI9qMcjFUC1jM6NQ0RgNfy0VOZHlmNrGI");'></div>
                            <div>
                                <p class="text-sm font-bold" id="mobile-user-name"></p>
                                <p class="text-xs text-[#9c7349]" id="mobile-user-role"></p>
                            </div>
                        </div>
                        <button id="mobile-logout-button" class="w-full flex items-center gap-3 px-4 py-3 text-sm font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-xl transition-colors">
                            <span class="material-symbols-outlined">logout</span>
                            Đăng xuất
                        </button>
                    </div>
                    
                    <!-- Mobile Login Button -->
                    <div id="mobile-login-button" class="pt-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                        <a href="Đăng nhập.html" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                            <span class="material-symbols-outlined">login</span>
                            Đăng nhập
                        </a>
                    </div>
                </nav>
            </div>
        </header>

        <!-- AI Chatbot Launcher Button (Floating) -->
        <button id="chatbot-launcher" class="fixed bottom-6 right-6 z-50 w-14 h-14 bg-primary text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 transition-all duration-300 chatbot-launcher">
            <span class="material-symbols-outlined text-2xl">smart_toy</span>
            <span id="chat-notification" class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-extrabold text-white border-2 border-white dark:border-[#221910] hidden">1</span>
        </button>

        <!-- AI Chatbot Window (Hidden by default) -->
        <div id="chatbot-window" class="fixed bottom-24 right-6 z-50 w-80 md:w-96 h-[500px] bg-white dark:bg-[#2a2015] rounded-2xl shadow-2xl border border-[#f4ede7] dark:border-[#3d2e1f] overflow-hidden flex flex-col hidden">
            <!-- Chatbot Header -->
            <div class="p-4 border-b border-[#f4ede7] dark:border-[#3d2e1f] bg-primary/5">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center">
                            <span class="material-symbols-outlined text-primary">smart_toy</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-sm">FoodGo Assistant</h3>
                            <p class="text-xs text-[#9c7349]">AI đang trực tuyến</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="minimize-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">minimize</span>
                        </button>
                        <button id="close-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">close</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatbot-messages" class="flex-1 p-4 overflow-y-auto no-scrollbar space-y-4">
                <!-- Welcome message -->
                <div class="chatbot-message">
                    <div class="flex items-end gap-2">
                        <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                            <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                        </div>
                        <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                            <p class="text-sm">Xin chào! Tôi là FoodGo Assistant. Tôi có thể giúp bạn:</p>
                            <ul class="text-xs mt-2 space-y-1">
                                <li>• Tìm món ăn theo sở thích</li>
                                <li>• Gợi ý món ăn theo ngân sách</li>
                                <li>• Tư vấn chế độ ăn uống</li>
                                <li>• Giải đáp thông tin về thực đơn</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Suggestions -->
            <div id="quick-suggestions" class="px-4 pb-3 border-t border-[#f4ede7] dark:border-[#3d2e1f] pt-3">
                <div class="flex flex-wrap gap-2">
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">restaurant</span>
                        Món chính
                    </button>
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">local_cafe</span>
                        Đồ uống
                    </button>
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">discount</span>
                        Combo
                    </button>
                    <button class="quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                        <span class="material-symbols-outlined text-xs">sell</span>
                        Khuyến mãi
                    </button>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="p-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                <div class="relative">
                    <input id="chatbot-input" type="text" placeholder="Nhập câu hỏi của bạn..." 
                           class="w-full h-12 pl-4 pr-12 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] border-none text-sm focus:ring-2 focus:ring-primary/50 outline-none"/>
                    <button id="send-message" class="absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 bg-primary text-white rounded-full flex items-center justify-center hover:opacity-90">
                        <span class="material-symbols-outlined text-sm">send</span>
                    </button>
                </div>
                <p class="text-[10px] text-[#9c7349] mt-2 text-center">FoodGo Assistant có thể mắc lỗi. Vui lòng kiểm tra thông tin quan trọng.</p>
            </div>
        </div>

        <!-- Mobile AI Chatbot -->
        <div id="mobile-chatbot-window" class="fixed inset-0 z-50 bg-black/50 hidden lg:hidden">
            <div class="absolute inset-0 bg-black/50" id="mobile-chatbot-backdrop"></div>
            <div class="absolute bottom-0 left-0 right-0 h-4/5 bg-white dark:bg-[#2a2015] rounded-t-2xl overflow-hidden flex flex-col">
                <!-- Mobile Chatbot Header -->
                <div class="p-4 border-b border-[#f4ede7] dark:border-[#3d2e1f] bg-primary/5">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="h-10 w-10 bg-primary/10 rounded-xl flex items-center justify-center">
                                <span class="material-symbols-outlined text-primary">smart_toy</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-sm">FoodGo Assistant</h3>
                                <p class="text-xs text-[#9c7349]">AI đang trực tuyến</p>
                            </div>
                        </div>
                        <button id="close-mobile-chatbot" class="p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-[#3d2e1f]">
                            <span class="material-symbols-outlined text-lg">close</span>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Chat Messages -->
                <div id="mobile-chatbot-messages" class="flex-1 p-4 overflow-y-auto no-scrollbar space-y-4">
                    <div class="chatbot-message">
                        <div class="flex items-end gap-2">
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                            </div>
                            <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                <p class="text-sm">Xin chào! Tôi là FoodGo Assistant. Tôi có thể giúp bạn tìm món ăn phù hợp!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Quick Suggestions -->
                <div id="mobile-quick-suggestions" class="px-4 pb-3 border-t border-[#f4ede7] dark:border-[#3d2e1f] pt-3">
                    <div class="flex flex-wrap gap-2">
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">restaurant</span>
                            Món chính
                        </button>
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">local_cafe</span>
                            Đồ uống
                        </button>
                        <button class="mobile-quick-suggestion-btn text-xs bg-[#f4ede7] dark:bg-[#3d2e1f] px-3 py-1.5 rounded-xl hover:bg-primary/10 transition-colors flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs">discount</span>
                            Combo
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Chat Input -->
                <div class="p-4 border-t border-[#f4ede7] dark:border-[#3d2e1f]">
                    <div class="relative">
                        <input id="mobile-chatbot-input" type="text" placeholder="Nhập câu hỏi của bạn..." 
                               class="w-full h-12 pl-4 pr-12 rounded-2xl bg-[#f4ede7] dark:bg-[#3d2e1f] border-none text-sm focus:ring-2 focus:ring-primary/50 outline-none"/>
                        <button id="send-mobile-message" class="absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 bg-primary text-white rounded-full flex items-center justify-center hover:opacity-90">
                            <span class="material-symbols-outlined text-sm">send</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading-spinner" class="fixed inset-0 bg-black/20 flex items-center justify-center z-[1000] hidden">
            <div class="loading-spinner"></div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed top-4 right-4 z-[1000] hidden">
            <div class="bg-white dark:bg-[#2a2015] rounded-xl shadow-2xl border border-[#f4ede7] dark:border-[#3d2e1f] p-4 max-w-xs flex items-center gap-3 fade-in">
                <div class="h-10 w-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined">check_circle</span>
                </div>
                <div class="flex-1">
                    <p class="font-bold text-sm" id="toast-title"></p>
                    <p class="text-xs text-[#9c7349]" id="toast-message"></p>
                </div>
                <button onclick="hideToast()" class="text-gray-400 hover:text-gray-600">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>

        <!-- Thực đơn (mặc định) -->
        <main id="thucDon" class="w-full max-w-[1200px] px-4 md:px-6 lg:px-8 xl:px-10 py-6 md:py-8">
            <div class="flex flex-col lg:flex-row gap-6 md:gap-8">
                <!-- Sidebar Filter -->
                <aside class="w-full lg:w-1/4 shrink-0">
                    <div class="sticky top-24 bg-white dark:bg-[#2a2015] p-5 md:p-6 rounded-2xl md:rounded-3xl border border-[#f4ede7] dark:border-[#3d2e1f] shadow-sm">
                        <div class="flex items-center justify-between mb-5 md:mb-6">
                            <h3 class="text-base md:text-lg font-bold">Bộ lọc</h3>
                            <button id="clear-filters" class="text-xs text-primary font-bold hover:underline">Xóa tất cả</button>
                        </div>
                        
                        <!-- Danh mục -->
                        <div class="mb-6 md:mb-8">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Danh mục</h4>
                            <div id="categories-list" class="flex flex-col gap-2 md:gap-3">
                                <!-- Categories will be loaded from database -->
                                <div class="text-center py-4">
                                    <div class="loading-spinner mx-auto"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Khoảng giá -->
                        <div class="mb-6 md:mb-8">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Khoảng giá</h4>
                            <div class="px-2">
                                <input id="price-range" class="w-full h-1.5 bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-lg appearance-none cursor-pointer accent-primary" 
                                       max="500000" min="0" step="10000" type="range" value="250000"/>
                                <div class="flex justify-between mt-3">
                                    <span class="text-xs font-bold text-[#9c7349]">0đ</span>
                                    <span id="current-price" class="text-xs font-bold text-primary">250.000đ</span>
                                    <span class="text-xs font-bold text-[#9c7349]">500.000đ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Đánh giá -->
                        <div class="mb-6">
                            <h4 class="text-sm font-bold text-[#1c140d] dark:text-white mb-3 md:mb-4 uppercase tracking-wider">Đánh giá</h4>
                            <div class="flex flex-col gap-2 md:gap-3">
                                <button data-rating="5" class="filter-rating flex items-center gap-2 px-3 py-2 rounded-xl bg-[#f4ede7] dark:bg-[#3d2e1f] hover:bg-primary/10 transition-colors w-full">
                                    <div class="flex text-yellow-500">
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                    </div>
                                    <span class="text-xs font-bold">5 sao</span>
                                </button>
                                <button data-rating="4" class="filter-rating flex items-center gap-2 px-3 py-2 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] hover:border-primary transition-colors w-full">
                                    <div class="flex text-yellow-500">
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm">star</span>
                                    </div>
                                    <span class="text-xs font-bold">Từ 4 sao</span>
                                </button>
                                <button data-rating="3" class="filter-rating flex items-center gap-2 px-3 py-2 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] hover:border-primary transition-colors w-full">
                                    <div class="flex text-yellow-500">
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm fill-1">star</span>
                                        <span class="material-symbols-outlined text-sm">star</span>
                                        <span class="material-symbols-outlined text-sm">star</span>
                                    </div>
                                    <span class="text-xs font-bold">Từ 3 sao</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Áp dụng bộ lọc -->
                        <button id="apply-filters" class="w-full h-12 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                            Áp dụng bộ lọc
                        </button>
                    </div>
                </aside>
                
                <!-- Main Content -->
                <div class="flex-1">
                    <!-- Header với sắp xếp -->
                    <div class="flex flex-col sm:flex-row items-center justify-between mb-6 md:mb-8 gap-4">
                        <div>
                            <h2 class="text-xl md:text-2xl font-black tracking-tight">Thực đơn của chúng tôi</h2>
                            <p id="result-count" class="text-sm text-[#9c7349]">Đang tải...</p>
                        </div>
                        <div class="flex gap-2">
                            <select id="sort-select" class="h-11 px-4 rounded-2xl bg-white dark:bg-[#2a2015] border border-[#f4ede7] dark:border-[#3d2e1f] text-sm font-bold focus:ring-primary cursor-pointer outline-none">
                                <option value="popular">Phổ biến nhất</option>
                                <option value="newest">Mới nhất</option>
                                <option value="price_asc">Giá tăng dần</option>
                                <option value="price_desc">Giá giảm dần</option>
                                <option value="rating">Đánh giá cao nhất</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Food Grid -->
                    <div id="foods-grid" class="grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <!-- Foods will be loaded from database -->
                        <div class="col-span-full text-center py-8">
                            <div class="loading-spinner mx-auto"></div>
                            <p class="mt-4 text-[#9c7349]">Đang tải thực đơn...</p>
                        </div>
                    </div>
                    
                    <!-- Pagination -->
                    <div class="flex justify-center mt-8 md:mt-12 gap-2">
                        <button id="prev-page" class="w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors">
                            <span class="material-symbols-outlined">chevron_left</span>
                        </button>
                        <div id="pagination-numbers" class="flex gap-2">
                            <button class="w-10 h-10 rounded-xl bg-primary text-white font-bold flex items-center justify-center">1</button>
                        </div>
                        <button id="next-page" class="w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors">
                            <span class="material-symbols-outlined">chevron_right</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Chi tiết món ăn (ẩn mặc định) -->
        <main id="chiTietMonAn" class="w-full max-w-[1200px] px-4 md:px-6 lg:px-8 xl:px-10 py-6 md:py-8 hidden">
            <!-- Breadcrumb -->
            <nav class="flex items-center gap-2 text-sm text-[#9c7349] mb-6 md:mb-8 flex-wrap">
                <a class="hover:text-primary cursor-pointer" onclick="showMenu()">Thực đơn</a>
                <span class="material-symbols-outlined text-xs">chevron_right</span>
                <span id="food-category" class="hover:text-primary cursor-pointer">Danh mục</span>
                <span class="material-symbols-outlined text-xs">chevron_right</span>
                <span class="font-bold text-[#1c140d] dark:text-white truncate" id="foodName">Đang tải...</span>
            </nav>
            
            <!-- Food Detail Content -->
            <div id="food-detail-content" class="bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-[2.5rem] p-5 md:p-8 lg:p-10 border border-[#f4ede7] dark:border-[#3d2e1f] shadow-sm flex flex-col lg:flex-row gap-8 md:gap-12">
                <!-- Loading state -->
                <div class="w-full lg:w-1/2">
                    <div class="aspect-square rounded-2xl md:rounded-[2rem] overflow-hidden bg-[#f4ede7] dark:bg-[#3d2e1f] flex items-center justify-center">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                <div class="w-full lg:w-1/2 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <div id="food-badges" class="space-x-2"></div>
                        <div id="food-rating" class="flex items-center gap-1">
                            <span class="material-symbols-outlined text-yellow-500 fill-1">star</span>
                            <span class="font-bold">0.0</span>
                            <span class="text-xs text-[#9c7349]">(0 đánh giá)</span>
                        </div>
                    </div>
                    <h1 id="foodTitle" class="text-2xl md:text-3xl lg:text-4xl font-black tracking-tight mb-3 md:mb-4">Đang tải...</h1>
                    <div class="flex items-center gap-3 md:gap-4 mb-4 md:mb-6">
                        <span id="foodPrice" class="text-2xl md:text-3xl font-black text-primary">0đ</span>
                        <span id="foodOriginalPrice" class="text-lg md:text-xl text-[#9c7349] line-through decoration-2 hidden"></span>
                    </div>
                    <p id="foodDescription" class="text-[#9c7349] dark:text-gray-300 leading-relaxed mb-6 md:mb-8">
                        Đang tải mô tả...
                    </p>
                    
                    <!-- Food Info Grid -->
                    <div class="grid grid-cols-2 gap-3 md:gap-4 mb-6 md:mb-8">
                        <div class="p-3 md:p-4 rounded-xl md:rounded-2xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg md:text-xl">timer</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Thời gian</span>
                            </div>
                            <p id="food-time" class="font-bold text-sm md:text-base">-- phút</p>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl md:rounded-2xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg md:text-xl">inventory_2</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Tồn kho</span>
                            </div>
                            <p id="food-stock" class="font-bold text-sm md:text-base">-- phần</p>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl md:rounded-2xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg md:text-xl">restaurant</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Đã bán</span>
                            </div>
                            <p id="food-sold" class="font-bold text-sm md:text-base">-- phần</p>
                        </div>
                        <div class="p-3 md:p-4 rounded-xl md:rounded-2xl bg-[#f8f7f5] dark:bg-[#3d2e1f] border border-[#f4ede7] dark:border-[#4d3a27]">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-primary text-lg md:text-xl">local_fire_department</span>
                                <span class="text-xs font-bold text-[#9c7349] uppercase">Calo</span>
                            </div>
                            <p id="food-calories" class="font-bold text-sm md:text-base">-- kcal</p>
                        </div>
                    </div>
                    
                    <!-- Add to Cart Section -->
                    <div class="flex flex-col sm:flex-row items-center gap-3 md:gap-4 mt-auto">
                        <div class="flex items-center bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-xl md:rounded-2xl h-12 md:h-14 px-2">
                            <button id="decrease-qty" class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-primary/20 transition-all">
                                <span class="material-symbols-outlined">remove</span>
                            </button>
                            <input id="quantity-input" class="w-10 md:w-12 bg-transparent border-none text-center font-bold focus:ring-0 text-sm md:text-base" 
                                   readonly type="text" value="1" min="1" max="99"/>
                            <button id="increase-qty" class="w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-lg hover:bg-white dark:hover:bg-primary/20 transition-all">
                                <span class="material-symbols-outlined">add</span>
                            </button>
                        </div>
                        <button id="add-to-cart-detail" class="flex-1 w-full h-12 md:h-14 bg-primary text-white font-bold rounded-xl md:rounded-2xl flex items-center justify-center gap-2 md:gap-3 hover:shadow-lg hover:shadow-primary/30 transition-all active:scale-95">
                            <span class="material-symbols-outlined">shopping_cart</span>
                            <span class="text-sm md:text-base">Thêm vào giỏ hàng</span>
                        </button>
                        <button id="add-to-favorites" class="w-12 h-12 md:w-14 md:h-14 flex items-center justify-center rounded-xl md:rounded-2xl border-2 border-[#f4ede7] dark:border-[#3d2e1f] hover:border-primary transition-all group">
                            <span class="material-symbols-outlined group-hover:text-primary group-hover:fill-1">favorite</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Reviews Section -->
            <div id="reviews-section" class="mt-8 md:mt-12 hidden">
                <div class="flex items-center justify-between mb-6 md:mb-8">
                    <h3 class="text-xl md:text-2xl font-black tracking-tight">Đánh giá từ khách hàng</h3>
                    <button class="px-4 md:px-6 py-2 border-2 border-primary text-primary font-bold rounded-xl hover:bg-primary hover:text-white transition-all text-sm md:text-base">
                        Viết đánh giá
                    </button>
                </div>
                <div id="reviews-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                    <!-- Reviews will be loaded from database -->
                </div>
                <div id="no-reviews" class="text-center py-8 hidden">
                    <div class="h-16 w-16 bg-gray-100 dark:bg-[#3d2e1f] text-gray-400 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="material-symbols-outlined text-3xl">chat</span>
                    </div>
                    <h4 class="text-lg font-bold mb-2">Chưa có đánh giá nào</h4>
                    <p class="text-[#9c7349]">Hãy là người đầu tiên đánh giá món ăn này!</p>
                </div>
                <div class="flex justify-center mt-6 md:mt-8">
                    <button id="load-more-reviews" class="text-primary font-bold text-sm flex items-center gap-2 hover:underline">
                        Xem thêm đánh giá
                        <span class="material-symbols-outlined text-sm">expand_more</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="w-full bg-[#1c140d] dark:bg-[#110d08] text-white py-10 md:py-16 mt-10 md:mt-20">
            <div class="max-w-[1200px] mx-auto px-4 md:px-6 lg:px-8 xl:px-10">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
                    <!-- Company Info -->
                    <div class="flex flex-col gap-4 md:gap-6">
                        <div class="flex items-center gap-2 text-primary">
                            <span class="material-symbols-outlined text-3xl font-bold">fastfood</span>
                            <h2 class="text-2xl font-extrabold tracking-tight">FoodGo</h2>
                        </div>
                        <p class="text-gray-400 text-sm leading-relaxed">
                            FoodGo mang đến trải nghiệm ẩm thực tuyệt vời ngay tại nhà. Chúng tôi cam kết chất lượng món ăn và tốc độ giao hàng nhanh nhất.
                        </p>
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">call</span>
                                <span class="text-sm">1900 1234</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">mail</span>
                                <span class="text-sm">support@foodgo.vn</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-400">
                                <span class="material-symbols-outlined text-primary text-lg">location_on</span>
                                <span class="text-sm">Quận 1, TP. Hồ Chí Minh</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Links -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Liên kết nhanh</h4>
                        <ul class="text-gray-400 text-sm space-y-3 md:space-y-4">
                            <li><a class="hover:text-primary transition-colors" href="Trang chủ.html">Trang chủ</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Thực đơn.html">Thực đơn</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Khuyến mãi.html">Khuyến mãi</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Đơn hàng.html">Đơn hàng</a></li>
                        </ul>
                    </div>
                    
                    <!-- Customer Support -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Hỗ trợ khách hàng</h4>
                        <ul class="text-gray-400 text-sm space-y-3 md:space-y-4">
                            <li><a class="hover:text-primary transition-colors" href="#">Trung tâm trợ giúp</a></li>
                            <li><a class="hover:text-primary transition-colors" href="#">Chính sách hoàn tiền</a></li>
                            <li><a class="hover:text-primary transition-colors" href="Đơn hàng.html">Theo dõi đơn hàng</a></li>
                            <li><a class="hover:text-primary transition-colors" href="#">Câu hỏi thường gặp</a></li>
                        </ul>
                    </div>
                    
                    <!-- Download App -->
                    <div>
                        <h4 class="font-bold text-lg mb-4 md:mb-6">Tải ứng dụng</h4>
                        <p class="text-gray-400 text-sm mb-3 md:mb-4">Trải nghiệm đặt món tốt hơn trên điện thoại của bạn.</p>
                        <div class="flex flex-col gap-3">
                            <button class="bg-[#2a2015] px-4 md:px-6 py-3 rounded-xl flex items-center gap-3 text-sm font-bold hover:bg-gray-800 transition-colors border border-gray-700">
                                <span class="material-symbols-outlined">ios</span>
                                <div class="text-left">
                                    <p class="text-[10px] font-normal opacity-70">Download on the</p>
                                    <p class="text-xs md:text-sm">App Store</p>
                                </div>
                            </button>
                            <button class="bg-[#2a2015] px-4 md:px-6 py-3 rounded-xl flex items-center gap-3 text-sm font-bold hover:bg-gray-800 transition-colors border border-gray-700">
                                <span class="material-symbols-outlined">play_arrow</span>
                                <div class="text-left">
                                    <p class="text-[10px] font-normal opacity-70">Get it on</p>
                                    <p class="text-xs md:text-sm">Google Play</p>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Copyright -->
                <div class="border-t border-gray-800 mt-8 md:mt-16 pt-6 md:pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500">
                    <p class="text-center md:text-left mb-3 md:mb-0">© 2024 FoodGo. Bản quyền thuộc về FoodGo Team.</p>
                    <div class="flex gap-4 md:gap-6">
                        <a class="hover:text-white transition-colors" href="#">Chính sách bảo mật</a>
                        <a class="hover:text-white transition-colors" href="#">Điều khoản sử dụng</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Logout Modal -->
    <div id="logout-modal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000] p-4">
        <div class="bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-3xl p-6 md:p-8 max-w-sm w-full text-center">
            <div class="h-14 w-14 md:h-16 md:w-16 bg-orange-100 text-primary rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-symbols-outlined text-2xl md:text-3xl">logout</span>
            </div>
            <h3 class="text-lg md:text-xl font-black mb-4">Đăng xuất</h3>
            <p class="text-[#9c7349] mb-6">Bạn có chắc chắn muốn đăng xuất khỏi tài khoản?</p>
            <div class="flex gap-3">
                <button id="cancel-logout" class="flex-1 h-11 md:h-12 bg-gray-100 text-gray-700 font-bold rounded-xl hover:bg-gray-200 transition-all">
                    Hủy
                </button>
                <button id="confirm-logout" class="flex-1 h-11 md:h-12 bg-primary text-white font-bold rounded-xl hover:opacity-90 transition-all">
                    Đăng xuất
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'api'; // Đổi thành đường dẫn API của bạn
        let currentFoodId = null;
        let currentPage = 1;
        let totalPages = 1;
        let filters = {
            category_id: 0,
            min_price: 0,
            max_price: 500000,
            min_rating: 0,
            sort_by: 'popular'
        };
        
        // Chatbot state
        let isChatbotOpen = false;
        let unreadMessages = 0;

        // Initialize demo data
        function initDemoData() {
            if (!localStorage.getItem('foodgo_users')) {
                const demoUsers = [
                    {
                        id: 1,
                        fullName: "Nguyễn Văn Khách",
                        phone: "0912345678",
                        email: "customer@foodgo.vn",
                        username: "customer123",
                        password: "123456",
                        role: "customer",
                        createdAt: "2024-01-01"
                    },
                    {
                        id: 2,
                        fullName: "Trần Thị Nhân Viên",
                        phone: "0923456789",
                        email: "staff@foodgo.vn",
                        username: "staff456",
                        password: "123456",
                        role: "staff",
                        createdAt: "2024-01-01"
                    },
                    {
                        id: 3,
                        fullName: "Admin FoodGo",
                        phone: "0934567890",
                        email: "admin@foodgo.vn",
                        username: "admin789",
                        password: "123456",
                        role: "admin",
                        createdAt: "2024-01-01"
                    }
                ];
                localStorage.setItem('foodgo_users', JSON.stringify(demoUsers));
            }
            
            if (!localStorage.getItem('foodgo_cart')) {
                localStorage.setItem('foodgo_cart', JSON.stringify([]));
            }
            
            // Initialize chatbot history
            if (!localStorage.getItem('foodgo_chat_history')) {
                localStorage.setItem('foodgo_chat_history', JSON.stringify([]));
            }
        }

        // Check authentication
        function checkAuth() {
            const currentUser = JSON.parse(localStorage.getItem('foodgo_current_user') || 'null');
            const notLoggedIn = document.getElementById('not-logged-in');
            const loggedIn = document.getElementById('logged-in');
            const mobileUserInfo = document.getElementById('mobile-user-info');
            const mobileLoginButton = document.getElementById('mobile-login-button');
            
            if (currentUser) {
                notLoggedIn.style.display = 'none';
                loggedIn.style.display = 'block';
                mobileUserInfo.style.display = 'block';
                mobileLoginButton.style.display = 'none';
                
                document.getElementById('user-name').textContent = currentUser.fullName;
                document.getElementById('user-role').textContent = getRoleName(currentUser.role);
                document.getElementById('mobile-user-name').textContent = currentUser.fullName;
                document.getElementById('mobile-user-role').textContent = getRoleName(currentUser.role);
            } else {
                notLoggedIn.style.display = 'block';
                loggedIn.style.display = 'none';
                mobileUserInfo.style.display = 'none';
                mobileLoginButton.style.display = 'block';
            }
            
            updateCartCount();
        }

        // Get role name
        function getRoleName(role) {
            const roles = {
                'customer': 'Khách hàng',
                'staff': 'Nhân viên',
                'admin': 'Quản trị viên'
            };
            return roles[role] || role;
        }

        // Mobile menu toggle
        document.getElementById('mobile-menu-button')?.addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            const searchBar = document.getElementById('mobile-search-bar');
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                searchBar.classList.add('hidden');
            } else {
                menu.classList.add('hidden');
            }
        });

        // Mobile search toggle
        document.getElementById('mobile-search-button')?.addEventListener('click', function() {
            const searchBar = document.getElementById('mobile-search-bar');
            const menu = document.getElementById('mobile-menu');
            
            if (searchBar.classList.contains('hidden')) {
                searchBar.classList.remove('hidden');
                menu.classList.add('hidden');
            } else {
                searchBar.classList.add('hidden');
            }
        });

        // Setup logout
        function setupLogout() {
            const logoutButtons = ['logout-button', 'mobile-logout-button', 'confirm-logout'];
            const cancelButton = document.getElementById('cancel-logout');
            const modal = document.getElementById('logout-modal');
            
            logoutButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function(e) {
                        if (btnId === 'confirm-logout') {
                            performLogout();
                        } else {
                            e.preventDefault();
                            modal.classList.remove('hidden');
                            modal.classList.add('flex');
                        }
                    });
                }
            });
            
            if (cancelButton) {
                cancelButton.addEventListener('click', function() {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });
            }
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            });
        }

        // Perform logout
        function performLogout() {
            localStorage.removeItem('foodgo_current_user');
            document.getElementById('logout-modal').classList.add('hidden');
            showToast('Đăng xuất thành công', 'Bạn đã đăng xuất khỏi tài khoản.');
            
            setTimeout(() => {
                location.reload();
            }, 1500);
        }

        // Update cart count
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('foodgo_cart') || '[]');
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.getElementById('cart-count').textContent = count;
            return count;
        }

        // Toast notification
        function showToast(title, message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-title').textContent = title;
            document.getElementById('toast-message').textContent = message;
            
            toast.classList.remove('hidden');
            toast.style.animation = 'fadeIn 0.3s ease-in';
            
            setTimeout(hideToast, 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.add('hidden');
        }

        // Show loading
        function showLoading() {
            document.getElementById('loading-spinner').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-spinner').classList.add('hidden');
        }

        // API Functions
        async function fetchAPI(endpoint, params = {}) {
            try {
                const queryString = new URLSearchParams(params).toString();
                const url = `${API_BASE_URL}/${endpoint}${queryString ? '?' + queryString : ''}`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                showToast('Lỗi', 'Không thể kết nối đến máy chủ');
                return { success: false, message: error.message };
            }
        }

        // Load categories from database
        async function loadCategories() {
            showLoading();
            try {
                // Try to fetch from API first
                const result = await fetchAPI('foods.php', { action: 'get_categories' });
                hideLoading();
                
                if (result.success) {
                    renderCategories(result.data);
                } else {
                    // Fallback to demo data if API fails
                    renderDemoCategories();
                }
            } catch (error) {
                hideLoading();
                renderDemoCategories();
            }
        }

        // Render demo categories (fallback)
        function renderDemoCategories() {
            const demoCategories = [
                { id: 1, name: 'Món chính', description: 'Các món ăn chính', food_count: 15 },
                { id: 2, name: 'Đồ ăn nhanh', description: 'Hamburger, pizza, gà rán', food_count: 10 },
                { id: 3, name: 'Đồ uống', description: 'Nước giải khát, trà, cà phê', food_count: 8 },
                { id: 4, name: 'Tráng miệng', description: 'Bánh ngọt, kem, chè', food_count: 6 },
                { id: 5, name: 'Combo', description: 'Combo tiết kiệm', food_count: 5 }
            ];
            renderCategories(demoCategories);
        }

        // Render categories
        function renderCategories(categories) {
            const container = document.getElementById('categories-list');
            
            let html = `
                <label class="flex items-center gap-3 cursor-pointer group" data-category-id="0">
                    <input type="checkbox" class="category-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary" checked>
                    <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">Tất cả món</span>
                </label>
            `;
            
            categories.forEach(category => {
                html += `
                    <label class="flex items-center gap-3 cursor-pointer group" data-category-id="${category.id}">
                        <input type="checkbox" class="category-checkbox w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary">
                        <span class="text-sm font-medium text-[#9c7349] dark:text-gray-300 group-hover:text-primary transition-colors">${category.name}</span>
                    </label>
                `;
            });
            
            container.innerHTML = html;
            
            // Add event listeners to checkboxes
            document.querySelectorAll('.category-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const label = this.closest('label');
                    const categoryId = label.dataset.categoryId;
                    
                    if (categoryId === "0") {
                        // If "All" is checked, uncheck others
                        if (this.checked) {
                            document.querySelectorAll('.category-checkbox:not([data-category-id="0"])').forEach(cb => {
                                cb.checked = false;
                            });
                            filters.category_id = 0;
                        }
                    } else {
                        // If other category is checked, uncheck "All"
                        if (this.checked) {
                            document.querySelector('[data-category-id="0"] .category-checkbox').checked = false;
                            filters.category_id = parseInt(categoryId);
                        } else {
                            // If no category is selected, check "All"
                            const anyChecked = document.querySelector('.category-checkbox:checked:not([data-category-id="0"])');
                            if (!anyChecked) {
                                document.querySelector('[data-category-id="0"] .category-checkbox').checked = true;
                                filters.category_id = 0;
                            }
                        }
                    }
                });
            });
        }

        // Load foods from database
        async function loadFoods() {
            showLoading();
            
            try {
                const params = {
                    action: 'get_filtered_foods',
                    category_id: filters.category_id,
                    min_price: filters.min_price,
                    max_price: filters.max_price,
                    min_rating: filters.min_rating,
                    sort_by: filters.sort_by,
                    page: currentPage,
                    limit: 9
                };
                
                const result = await fetchAPI('foods.php', params);
                hideLoading();
                
                if (result.success) {
                    renderFoods(result.data);
                    totalPages = Math.ceil(result.total / 9);
                    document.getElementById('result-count').textContent = `Hiển thị ${result.data.length} kết quả trên tổng ${result.total} món`;
                    updatePagination();
                } else {
                    // Fallback to demo data
                    renderDemoFoods();
                }
            } catch (error) {
                hideLoading();
                renderDemoFoods();
            }
        }

        // Render demo foods (fallback)
        function renderDemoFoods() {
            const demoFoods = [
                {
                    id: 1,
                    name: 'Phở Bò Truyền Thống',
                    price: 55000,
                    original_price: 65000,
                    image_url: 'https://images.unsplash.com/photo-1552465011-b4e30bf7349d?w=800&auto=format&fit=crop',
                    short_description: 'Phở bò thơm ngon, nước dùng đậm đà',
                    stock_quantity: 50,
                    avg_rating: 4.8,
                    category_id: 1,
                    category_name: 'Món chính'
                },
                {
                    id: 2,
                    name: 'Hamburger Bò Phô Mai',
                    price: 75000,
                    original_price: 85000,
                    image_url: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w-800&auto=format&fit=crop',
                    short_description: 'Burger bò kẹp phô mai thơm ngon',
                    stock_quantity: 30,
                    avg_rating: 4.5,
                    category_id: 2,
                    category_name: 'Đồ ăn nhanh'
                },
                {
                    id: 3,
                    name: 'Trà Sữa Trân Châu',
                    price: 35000,
                    original_price: 45000,
                    image_url: 'https://images.unsplash.com/photo-1561128410-7ddd7c5f8c9a?w-800&auto=format&fit=crop',
                    short_description: 'Trà sữa thơm ngon, trân châu dai giòn',
                    stock_quantity: 100,
                    avg_rating: 4.7,
                    category_id: 3,
                    category_name: 'Đồ uống'
                },
                {
                    id: 4,
                    name: 'Bánh Tiramisu',
                    price: 45000,
                    original_price: 55000,
                    image_url: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w-800&auto=format&fit=crop',
                    short_description: 'Bánh tiramisu Ý thơm ngon',
                    stock_quantity: 20,
                    avg_rating: 4.9,
                    category_id: 4,
                    category_name: 'Tráng miệng'
                },
                {
                    id: 5,
                    name: 'Combo Gà Rán 2 Người',
                    price: 120000,
                    original_price: 150000,
                    image_url: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?w-800&auto=format&fit=crop',
                    short_description: 'Combo gà rán + khoai tây + nước ngọt',
                    stock_quantity: 25,
                    avg_rating: 4.6,
                    category_id: 5,
                    category_name: 'Combo'
                },
                {
                    id: 6,
                    name: 'Cơm Gà Xối Mỡ',
                    price: 65000,
                    original_price: 75000,
                    image_url: 'https://images.unsplash.com/photo-1603133872878-684f2065f5b8?w-800&auto=format&fit=crop',
                    short_description: 'Cơm gà giòn da thơm ngon',
                    stock_quantity: 40,
                    avg_rating: 4.4,
                    category_id: 1,
                    category_name: 'Món chính'
                },
                {
                    id: 7,
                    name: 'Pizza Hải Sản',
                    price: 180000,
                    original_price: 220000,
                    image_url: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w-800&auto=format&fit=crop',
                    short_description: 'Pizza hải sản đầy đặn',
                    stock_quantity: 15,
                    avg_rating: 4.7,
                    category_id: 2,
                    category_name: 'Đồ ăn nhanh'
                },
                {
                    id: 8,
                    name: 'Cà Phê Sữa Đá',
                    price: 25000,
                    original_price: 30000,
                    image_url: 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w-800&auto=format&fit=crop',
                    short_description: 'Cà phê sữa đá đậm đà',
                    stock_quantity: 80,
                    avg_rating: 4.8,
                    category_id: 3,
                    category_name: 'Đồ uống'
                },
                {
                    id: 9,
                    name: 'Kem Chocolate',
                    price: 35000,
                    original_price: 45000,
                    image_url: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?w-800&auto=format&fit=crop',
                    short_description: 'Kem chocolate ngọt ngào',
                    stock_quantity: 35,
                    avg_rating: 4.6,
                    category_id: 4,
                    category_name: 'Tráng miệng'
                }
            ];
            
            // Filter demo foods based on current filters
            let filteredFoods = demoFoods.filter(food => {
                if (filters.category_id > 0 && food.category_id !== filters.category_id) return false;
                if (food.price > filters.max_price) return false;
                if (food.avg_rating < filters.min_rating) return false;
                return true;
            });
            
            // Sort demo foods
            filteredFoods.sort((a, b) => {
                switch(filters.sort_by) {
                    case 'price_asc': return a.price - b.price;
                    case 'price_desc': return b.price - a.price;
                    case 'rating': return b.avg_rating - a.avg_rating;
                    case 'newest': return b.id - a.id;
                    default: return 0; // popular
                }
            });
            
            renderFoods(filteredFoods);
            document.getElementById('result-count').textContent = `Hiển thị ${filteredFoods.length} kết quả`;
        }

        // Render foods
        function renderFoods(foods) {
            const container = document.getElementById('foods-grid');
            
            if (foods.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="h-16 w-16 bg-gray-100 dark:bg-[#3d2e1f] text-gray-400 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="material-symbols-outlined text-3xl">search_off</span>
                        </div>
                        <h4 class="text-lg font-bold mb-2">Không tìm thấy món ăn</h4>
                        <p class="text-[#9c7349]">Hãy thử điều chỉnh bộ lọc hoặc tìm kiếm món khác</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            foods.forEach(food => {
                const isOutOfStock = food.stock_quantity <= 0;
                const hasDiscount = food.original_price > food.price;
                const discountPercent = hasDiscount ? Math.round((food.original_price - food.price) / food.original_price * 100) : 0;
                
                html += `
                    <div class="group bg-white dark:bg-[#2a2015] rounded-2xl md:rounded-3xl overflow-hidden border border-[#f4ede7] dark:border-[#3d2e1f] hover:shadow-xl transition-all duration-300 menu-item ${isOutOfStock ? 'opacity-60' : ''}">
                        ${hasDiscount ? `
                            <div class="absolute top-3 left-3 z-10">
                                <span class="px-2 py-1 bg-red-500 text-white text-xs font-bold rounded-lg">-${discountPercent}%</span>
                            </div>
                        ` : ''}
                        
                        <div class="relative h-40 xs:h-48 md:h-52 overflow-hidden cursor-pointer" onclick="showFoodDetail(${food.id})">
                            <div class="absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-110" 
                                 style="background-image: url('${food.image_url}')"></div>
                            ${isOutOfStock ? `
                                <div class="absolute inset-0 bg-black/60 flex items-center justify-center">
                                    <span class="text-white font-bold text-sm">HẾT HÀNG</span>
                                </div>
                            ` : ''}
                            <div class="absolute top-3 right-3 bg-white/90 dark:bg-black/60 backdrop-blur-sm px-2 py-1 rounded-xl flex items-center gap-1">
                                <span class="material-symbols-outlined text-yellow-500 text-sm fill-1">star</span>
                                <span class="text-xs font-bold">${food.avg_rating || 0}</span>
                            </div>
                        </div>
                        <div class="p-4 md:p-5">
                            <h3 class="font-bold text-base md:text-lg mb-1 group-hover:text-primary transition-colors truncate" onclick="showFoodDetail(${food.id})" style="cursor: pointer;">
                                ${food.name}
                            </h3>
                            <p class="text-[#9c7349] dark:text-gray-400 text-xs mb-3 md:mb-4 line-clamp-2">${food.short_description || 'Món ăn hấp dẫn'}</p>
                            <div class="flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-lg md:text-xl font-extrabold text-[#1c140d] dark:text-white">
                                        ${new Intl.NumberFormat('vi-VN').format(food.price)}đ
                                    </span>
                                    ${hasDiscount ? `
                                        <span class="text-xs text-[#9c7349] line-through">
                                            ${new Intl.NumberFormat('vi-VN').format(food.original_price)}đ
                                        </span>
                                    ` : ''}
                                </div>
                                <button class="add-to-cart-btn h-9 w-9 md:h-10 md:w-10 bg-primary text-white rounded-xl flex items-center justify-center hover:scale-110 transition-transform disabled:opacity-50 disabled:cursor-not-allowed"
                                        data-food-id="${food.id}"
                                        data-food-name="${food.name}"
                                        data-food-price="${food.price}"
                                        ${isOutOfStock ? 'disabled' : ''}>
                                    <span class="material-symbols-outlined">add_shopping_cart</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Add event listeners to add-to-cart buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const foodId = this.dataset.foodId;
                    const foodName = this.dataset.foodName;
                    const foodPrice = parseInt(this.dataset.foodPrice);
                    
                    addToCart(foodId, foodName, foodPrice);
                });
            });
        }

        // Update pagination
        function updatePagination() {
            const paginationNumbers = document.getElementById('pagination-numbers');
            let html = '';
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === currentPage) {
                    html += `<button class="w-10 h-10 rounded-xl bg-primary text-white font-bold flex items-center justify-center">${i}</button>`;
                } else {
                    html += `<button class="page-number w-10 h-10 rounded-xl border border-[#f4ede7] dark:border-[#3d2e1f] flex items-center justify-center hover:border-primary transition-colors" data-page="${i}">${i}</button>`;
                }
            }
            
            paginationNumbers.innerHTML = html;
            
            // Add event listeners to page numbers
            document.querySelectorAll('.page-number').forEach(button => {
                button.addEventListener('click', function() {
                    currentPage = parseInt(this.dataset.page);
                    loadFoods();
                });
            });
            
            // Update prev/next buttons
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = currentPage === totalPages;
        }

        // Show food detail
        async function showFoodDetail(foodId) {
            currentFoodId = foodId;
            
            // Switch to detail view
            document.getElementById('thucDon').classList.add('hidden');
            document.getElementById('chiTietMonAn').classList.remove('hidden');
            
            // Show loading in detail view
            document.getElementById('food-detail-content').innerHTML = `
                <div class="w-full lg:w-1/2">
                    <div class="aspect-square rounded-2xl md:rounded-[2rem] overflow-hidden bg-[#f4ede7] dark:bg-[#3d2e1f] flex items-center justify-center">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                <div class="w-full lg:w-1/2 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <div class="h-6 bg-gray-200 dark:bg-[#3d2e1f] rounded w-1/3"></div>
                        <div class="h-6 bg-gray-200 dark:bg-[#3d2e1f] rounded w-1/4"></div>
                    </div>
                    <div class="h-8 md:h-12 bg-gray-200 dark:bg-[#3d2e1f] rounded mb-4"></div>
                    <div class="h-6 bg-gray-200 dark:bg-[#3d2e1f] rounded w-1/2 mb-6"></div>
                    <div class="h-32 bg-gray-200 dark:bg-[#3d2e1f] rounded mb-8"></div>
                </div>
            `;
            
            // Load food detail
            showLoading();
            try {
                const result = await fetchAPI('foods.php', { 
                    action: 'get_food_detail', 
                    food_id: foodId 
                });
                hideLoading();
                
                if (result.success) {
                    renderFoodDetail(result.data);
                    loadReviews(foodId);
                } else {
                    // Fallback to demo detail
                    renderDemoFoodDetail(foodId);
                }
            } catch (error) {
                hideLoading();
                renderDemoFoodDetail(foodId);
            }
        }

        // Render demo food detail (fallback)
        function renderDemoFoodDetail(foodId) {
            const demoFoods = {
                1: {
                    id: 1,
                    name: 'Phở Bò Truyền Thống',
                    price: 55000,
                    original_price: 65000,
                    image_url: 'https://images.unsplash.com/photo-1552465011-b4e30bf7349d?w=800&auto=format&fit=crop',
                    description: 'Phở bò truyền thống với nước dùng được ninh từ xương bò trong 12 giờ, thịt bò tái mềm, bánh phở dai vừa phải. Kèm theo rau thơm, chanh, ớt và giá đỗ.',
                    category_name: 'Món chính',
                    preparation_time: 15,
                    stock_quantity: 50,
                    sold_count: 1234,
                    calories: 450,
                    is_best_seller: true,
                    is_featured: true,
                    average_rating: 4.8,
                    review_count: 156
                },
                2: {
                    id: 2,
                    name: 'Hamburger Bò Phô Mai',
                    price: 75000,
                    original_price: 85000,
                    image_url: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w-800&auto=format&fit=crop',
                    description: 'Hamburger với thịt bò xay tươi, phô mai tan chảy, rau xà lách, cà chua và sốt đặc biệt. Bánh mì được nướng giòn bên ngoài, mềm bên trong.',
                    category_name: 'Đồ ăn nhanh',
                    preparation_time: 10,
                    stock_quantity: 30,
                    sold_count: 890,
                    calories: 650,
                    is_best_seller: true,
                    is_featured: false,
                    average_rating: 4.5,
                    review_count: 89
                }
            };
            
            const food = demoFoods[foodId] || demoFoods[1];
            renderFoodDetail(food);
        }

        // Render food detail
        function renderFoodDetail(food) {
            const hasDiscount = food.original_price > food.price;
            const isOutOfStock = food.stock_quantity <= 0;
            
            // Update breadcrumb
            document.getElementById('foodName').textContent = food.name;
            document.getElementById('food-category').textContent = food.category_name || 'Danh mục';
            
            // Create badges HTML
            let badgesHTML = '';
            if (food.is_best_seller) {
                badgesHTML += `<span class="px-2 py-1 bg-primary/10 text-primary rounded-full text-xs font-bold uppercase tracking-wider">Bán chạy</span>`;
            }
            if (food.is_featured) {
                badgesHTML += `<span class="px-2 py-1 bg-blue-500/10 text-blue-500 rounded-full text-xs font-bold uppercase tracking-wider">Nổi bật</span>`;
            }
            if (hasDiscount) {
                const discountPercent = Math.round((food.original_price - food.price) / food.original_price * 100);
                badgesHTML += `<span class="px-2 py-1 bg-red-500/10 text-red-500 rounded-full text-xs font-bold uppercase tracking-wider">-${discountPercent}%</span>`;
            }
            if (isOutOfStock) {
                badgesHTML += `<span class="px-2 py-1 bg-gray-500/10 text-gray-500 rounded-full text-xs font-bold uppercase tracking-wider">Hết hàng</span>`;
            }
            
            // Update main content
            document.getElementById('food-badges').innerHTML = badgesHTML;
            document.getElementById('foodTitle').textContent = food.name;
            document.getElementById('foodPrice').textContent = new Intl.NumberFormat('vi-VN').format(food.price) + 'đ';
            
            if (hasDiscount) {
                document.getElementById('foodOriginalPrice').textContent = new Intl.NumberFormat('vi-VN').format(food.original_price) + 'đ';
                document.getElementById('foodOriginalPrice').classList.remove('hidden');
            }
            
            document.getElementById('foodDescription').textContent = food.description || food.short_description || 'Món ăn hấp dẫn';
            
            // Update info grid
            document.getElementById('food-time').textContent = food.preparation_time ? `${food.preparation_time} phút` : '15-20 phút';
            document.getElementById('food-stock').textContent = food.stock_quantity || '0';
            document.getElementById('food-sold').textContent = food.sold_count || '0';
            document.getElementById('food-calories').textContent = food.calories ? `${food.calories} kcal` : '-- kcal';
            
            // Update rating
            document.getElementById('food-rating').innerHTML = `
                <span class="material-symbols-outlined text-yellow-500 fill-1">star</span>
                <span class="font-bold">${food.average_rating || food.avg_rating || 0}</span>
                <span class="text-xs text-[#9c7349]">(${food.review_count || 0} đánh giá)</span>
            `;
            
            // Update image
            const imageContainer = document.getElementById('food-detail-content').querySelector('.lg\\:w-1\\/2');
            imageContainer.innerHTML = `
                <div class="aspect-square rounded-2xl md:rounded-[2rem] overflow-hidden bg-[#f4ede7] dark:bg-[#3d2e1f]">
                    <img src="${food.image_url}" alt="${food.name}" class="w-full h-full object-cover">
                </div>
            `;
            
            // Update add to cart button state
            const addToCartBtn = document.getElementById('add-to-cart-detail');
            if (isOutOfStock) {
                addToCartBtn.disabled = true;
                addToCartBtn.innerHTML = '<span class="material-symbols-outlined">block</span><span class="text-sm md:text-base">Hết hàng</span>';
                addToCartBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                addToCartBtn.disabled = false;
                addToCartBtn.innerHTML = '<span class="material-symbols-outlined">shopping_cart</span><span class="text-sm md:text-base">Thêm vào giỏ hàng</span>';
                addToCartBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Load reviews
        async function loadReviews(foodId) {
            // This would be implemented if your API supports getting reviews
            // For now, we'll just show/hide the reviews section
            const reviewsSection = document.getElementById('reviews-section');
            reviewsSection.classList.remove('hidden');
            
            // Show "no reviews" message if there are no reviews
            const noReviews = document.getElementById('no-reviews');
            noReviews.classList.remove('hidden');
        }

        // Show menu (go back from detail)
        function showMenu() {
            document.getElementById('chiTietMonAn').classList.add('hidden');
            document.getElementById('thucDon').classList.remove('hidden');
        }

        // Add to cart function
        async function addToCart(foodId, foodName, price) {
            const currentUser = JSON.parse(localStorage.getItem('foodgo_current_user') || 'null');
            const quantity = 1;
            
            try {
                // If user is logged in, call API
                if (currentUser) {
                    const response = await fetch(`${API_BASE_URL}/foods.php`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'add_to_cart',
                            user_id: currentUser.id,
                            food_id: foodId,
                            quantity: quantity
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showToast('Thành công', `Đã thêm "${foodName}" vào giỏ hàng`);
                        updateCartCount();
                    } else {
                        showToast('Lỗi', result.message || 'Không thể thêm vào giỏ hàng');
                    }
                } else {
                    // If user is not logged in, use localStorage
                    let cart = JSON.parse(localStorage.getItem('foodgo_cart') || '[]');
                    
                    const existingItem = cart.find(item => item.id === foodId);
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({
                            id: foodId,
                            name: foodName,
                            price: price,
                            quantity: quantity,
                            image_url: `https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=800&auto=format&fit=crop`
                        });
                    }
                    
                    localStorage.setItem('foodgo_cart', JSON.stringify(cart));
                    updateCartCount();
                    
                    // Button animation
                    const button = event?.target?.closest('.add-to-cart-btn') || document.querySelector(`[data-food-id="${foodId}"]`);
                    if (button) {
                        button.innerHTML = '<span class="material-symbols-outlined">check</span>';
                        button.style.backgroundColor = '#10b981';
                        
                        setTimeout(() => {
                            button.innerHTML = '<span class="material-symbols-outlined">add_shopping_cart</span>';
                            button.style.backgroundColor = '';
                        }, 1000);
                    }
                    
                    showToast('Thành công', `Đã thêm "${foodName}" vào giỏ hàng`);
                }
            } catch (error) {
                console.error('Error adding to cart:', error);
                showToast('Lỗi', 'Không thể thêm vào giỏ hàng');
            }
        }

        // AI Chatbot Functions
        function initChatbot() {
            // Chatbot launcher button
            const chatbotLauncher = document.getElementById('chatbot-launcher');
            const chatbotWindow = document.getElementById('chatbot-window');
            const closeChatbot = document.getElementById('close-chatbot');
            const minimizeChatbot = document.getElementById('minimize-chatbot');
            const mobileChatbotWindow = document.getElementById('mobile-chatbot-window');
            const mobileChatbotBackdrop = document.getElementById('mobile-chatbot-backdrop');
            const closeMobileChatbot = document.getElementById('close-mobile-chatbot');
            
            // Load chat history
            loadChatHistory();
            
            // Toggle chatbot window
            chatbotLauncher.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (window.innerWidth >= 768) {
                    // Desktop
                    if (chatbotWindow.classList.contains('hidden')) {
                        chatbotWindow.classList.remove('hidden');
                        isChatbotOpen = true;
                        clearUnreadMessages();
                    } else {
                        chatbotWindow.classList.add('hidden');
                        isChatbotOpen = false;
                    }
                } else {
                    // Mobile
                    mobileChatbotWindow.classList.remove('hidden');
                }
            });
            
            // Close chatbot
            closeChatbot.addEventListener('click', function() {
                chatbotWindow.classList.add('hidden');
                isChatbotOpen = false;
                saveChatHistory();
            });
            
            // Minimize chatbot
            minimizeChatbot.addEventListener('click', function() {
                chatbotWindow.classList.add('hidden');
                isChatbotOpen = false;
                saveChatHistory();
            });
            
            // Close mobile chatbot
            closeMobileChatbot.addEventListener('click', function() {
                mobileChatbotWindow.classList.add('hidden');
                saveChatHistory();
            });
            
            // Close mobile chatbot when clicking backdrop
            mobileChatbotBackdrop.addEventListener('click', function() {
                mobileChatbotWindow.classList.add('hidden');
                saveChatHistory();
            });
            
            // Close chatbot when clicking outside
            document.addEventListener('click', function(e) {
                if (!chatbotWindow.contains(e.target) && 
                    !chatbotLauncher.contains(e.target) && 
                    !chatbotWindow.classList.contains('hidden')) {
                    chatbotWindow.classList.add('hidden');
                    isChatbotOpen = false;
                    saveChatHistory();
                }
            });
            
            // Send message functionality
            const sendMessageBtn = document.getElementById('send-message');
            const chatbotInput = document.getElementById('chatbot-input');
            const chatbotMessages = document.getElementById('chatbot-messages');
            
            const sendMobileMessageBtn = document.getElementById('send-mobile-message');
            const mobileChatbotInput = document.getElementById('mobile-chatbot-input');
            const mobileChatbotMessages = document.getElementById('mobile-chatbot-messages');
            
            // Quick suggestion buttons
            document.querySelectorAll('.quick-suggestion-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const suggestion = this.textContent.trim();
                    chatbotInput.value = suggestion;
                    sendMessageHandler(chatbotInput, 'desktop');
                });
            });
            
            document.querySelectorAll('.mobile-quick-suggestion-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const suggestion = this.textContent.trim();
                    mobileChatbotInput.value = suggestion;
                    sendMessageHandler(mobileChatbotInput, 'mobile');
                });
            });
            
            function addMessage(message, isUser = false, target = 'desktop') {
                const messagesContainer = target === 'desktop' ? chatbotMessages : mobileChatbotMessages;
                const messageClass = isUser ? 'ml-auto bg-primary text-white rounded-2xl rounded-br-none' : 'bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none';
                
                const messageDiv = document.createElement('div');
                messageDiv.className = `chatbot-message ${isUser ? 'ml-auto' : ''}`;
                messageDiv.innerHTML = `
                    <div class="flex items-end gap-2 ${isUser ? 'flex-row-reverse' : ''}">
                        ${!isUser ? `
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                            </div>
                        ` : ''}
                        <div class="${messageClass} px-4 py-3 max-w-xs">
                            <p class="text-sm whitespace-pre-line">${message}</p>
                        </div>
                        ${isUser ? `
                            <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                <span class="material-symbols-outlined text-primary text-sm">person</span>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Save to history
                saveToChatHistory(message, isUser);
            }
            
            function addTypingIndicator(target = 'desktop') {
                const messagesContainer = target === 'desktop' ? chatbotMessages : mobileChatbotMessages;
                
                const typingDiv = document.createElement('div');
                typingDiv.className = 'chatbot-message';
                typingDiv.innerHTML = `
                    <div class="flex items-end gap-2">
                        <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                            <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                        </div>
                        <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                            <div class="typing-indicator">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                return typingDiv;
            }
            
            function removeTypingIndicator(typingDiv) {
                typingDiv.remove();
            }
            
            async function processUserMessage(message, target = 'desktop') {
                // Add user message
                addMessage(message, true, target);
                
                // Add typing indicator
                const typingDiv = addTypingIndicator(target);
                
                try {
                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Remove typing indicator
                    removeTypingIndicator(typingDiv);
                    
                    // Generate AI response
                    const response = generateAIResponse(message);
                    
                    // Add AI response
                    addMessage(response, false, target);
                    
                    // If chatbot is closed, show notification
                    if (!isChatbotOpen && target === 'desktop') {
                        addUnreadMessage();
                    }
                } catch (error) {
                    removeTypingIndicator(typingDiv);
                    addMessage('Xin lỗi, tôi gặp sự cố khi xử lý yêu cầu của bạn. Vui lòng thử lại sau.', false, target);
                }
            }
            
            function generateAIResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Check for specific keywords and provide appropriate responses
                if (lowerMessage.includes('món chính') || lowerMessage.includes('món ăn chính')) {
                    return `🍽️ **Món chính ngon tại FoodGo:**\n\n• **Phở Bò Truyền Thống** - 55,000đ\n• **Cơm Gà Xối Mỡ** - 65,000đ\n• **Bún Chả Hà Nội** - 60,000đ\n• **Cơm Tấm Sườn Nướng** - 70,000đ\n\nBạn muốn thử món nào? Tôi có thể tư vấn thêm về từng món!`;
                } else if (lowerMessage.includes('đồ ăn nhanh') || lowerMessage.includes('burger') || lowerMessage.includes('pizza')) {
                    return `🍔 **Menu đồ ăn nhanh phong phú:**\n\n• **Hamburger Bò Phô Mai** - 75,000đ\n• **Pizza Hải Sản** - 180,000đ\n• **Gà Rán Giòn** - 85,000đ (giảm 15%)\n• **Hotdog Phô Mai** - 45,000đ\n• **Khoai Tây Chiên** - 35,000đ\n\nMón nào bạn quan tâm nhất?`;
                } else if (lowerMessage.includes('đồ uống') || lowerMessage.includes('nước') || lowerMessage.includes('trà sữa') || lowerMessage.includes('cà phê')) {
                    return `🥤 **Đồ uống giải khát:**\n\n• **Trà Sữa Trân Châu** - 35,000đ\n• **Cà Phê Sữa Đá** - 25,000đ\n• **Nước Cam Ép** - 30,000đ\n• **Sinh Tố Bơ** - 40,000đ\n• **Trà Đào Cam Sả** - 30,000đ\n• **Soda Chanh** - 25,000đ\n\nBạn thích đồ uống có đường hay không đường?`;
                } else if (lowerMessage.includes('tráng miệng') || lowerMessage.includes('bánh') || lowerMessage.includes('kem')) {
                    return `🍰 **Món tráng miệng hấp dẫn:**\n\n• **Bánh Tiramisu** - 45,000đ\n• **Kem Chocolate** - 35,000đ\n• **Chè Thái** - 25,000đ\n• **Bánh Flan** - 20,000đ\n• **Kem Dừa** - 30,000đ\n\nMón nào hợp khẩu vị của bạn?`;
                } else if (lowerMessage.includes('combo') || lowerMessage.includes('tiết kiệm')) {
                    return `🎯 **Combo tiết kiệm - Ăn ngon giá tốt:**\n\n• **Combo Gà Rán 2 Người** - 120,000đ (tiết kiệm 30,000đ)\n• **Combo Burger + Nước** - 95,000đ\n• **Combo Gia Đình 4 Người** - 250,000đ (tiết kiệm 50,000đ)\n• **Combo Pizza Party** - 320,000đ (1 pizza lớn + 4 nước)\n\nCombo nào phù hợp với nhu cầu của bạn?`;
                } else if (lowerMessage.includes('giá') || lowerMessage.includes('rẻ') || lowerMessage.includes('đắt') || lowerMessage.includes('bao nhiêu')) {
                    return `💰 **Món ăn theo ngân sách:**\n\n• **Dưới 50,000đ**: Cà phê, nước ngọt, bánh flan, chè\n• **50,000-100,000đ**: Phở, cơm, burger, trà sữa, bún\n• **100,000-200,000đ**: Pizza, combo gà rán, món đặc biệt\n• **Trên 200,000đ**: Combo gia đình, pizza lớn, set nhiều món\n\nNgân sách của bạn là bao nhiêu? Tôi sẽ gợi ý phù hợp!`;
                } else if (lowerMessage.includes('khuyến mãi') || lowerMessage.includes('giảm giá') || lowerMessage.includes('promotion')) {
                    return `🎁 **Khuyến mãi hiện tại:**\n\n🔥 **Giảm 20%** cho đơn hàng đầu tiên\n🔥 **Mua 1 tặng 1** vào thứ 3 hàng tuần\n🔥 **Freeship** cho đơn từ 150,000đ\n🔥 **Tích điểm đổi quà** - 10 điểm = 1 phần tráng miệng\n\nTruy cập trang "Khuyến mãi" để biết thêm chi tiết!\n\nBạn có muốn biết món nào đang giảm giá không?`;
                } else if (lowerMessage.includes('đặt hàng') || lowerMessage.includes('mua') || lowerMessage.includes('order')) {
                    return `🛒 **Hướng dẫn đặt hàng:**\n\n1. **Chọn món** từ thực đơn\n2. **Nhấn "Thêm vào giỏ hàng"**\n3. **Vào giỏ hàng** để kiểm tra\n4. **Chọn phương thức thanh toán**\n5. **Nhập địa chỉ giao hàng**\n6. **Xác nhận đơn hàng**\n\n⏰ **Thời gian giao hàng:** 30-45 phút\n💰 **Phí ship:** 15,000đ (miễn phí đơn từ 150,000đ)\n\nCần tôi giúp bạn chọn món không?`;
                } else if (lowerMessage.includes('cảm ơn') || lowerMessage.includes('thanks') || lowerMessage.includes('thank you')) {
                    return `😊 **Không có gì!** Rất vui được giúp bạn.\n\nNếu bạn cần tư vấn thêm về món ăn, hãy cho tôi biết nhé!\n\nChúc bạn có bữa ăn ngon miệng tại FoodGo! 🍽️`;
                } else if (lowerMessage.includes('chào') || lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('xin chào')) {
                    return `👋 **Xin chào!** Tôi là FoodGo Assistant. 😊\n\nTôi có thể giúp bạn:\n• 🍽️ Tìm món ăn theo sở thích\n• 💰 Gợi ý món theo ngân sách\n• 🥗 Tư vấn chế độ ăn uống\n• ❓ Giải đáp về thực đơn\n• 🎯 Thông tin khuyến mãi\n\nBạn muốn biết gì về thực đơn của chúng tôi?`;
                } else if (lowerMessage.includes('gợi ý') || lowerMessage.includes('recommend') || lowerMessage.includes('nên ăn')) {
                    return `🤔 **Dựa trên đánh giá của khách hàng, tôi gợi ý:**\n\n⭐ **Món bán chạy nhất:**\n• Phở Bò Truyền Thống (4.8★)\n• Trà Sữa Trân Châu (4.7★)\n• Cà Phê Sữa Đá (4.8★)\n\n🔥 **Món đang giảm giá:**\n• Hamburger Bò Phô Mai (-12%)\n• Combo Gà Rán 2 Người (-20%)\n\n🍽️ **Món đặc biệt:**\n• Pizza Hải Sản\n• Bánh Tiramisu\n\nBạn có chế độ ăn đặc biệt nào không?`;
                } else if (lowerMessage.includes('chay') || lowerMessage.includes('vegetarian')) {
                    return `🌱 **Món chay tại FoodGo:**\n\n• **Cơm Chay Đậu Hũ** - 45,000đ\n• **Bún Chay** - 40,000đ\n• **Rau Củ Xào Chay** - 50,000đ\n• **Canh Chua Chay** - 35,000đ\n\nTất cả món chay đều được chế biến từ nguyên liệu tươi ngon, đảm bảo vệ sinh an toàn thực phẩm.`;
                } else if (lowerMessage.includes('calo') || lowerMessage.includes('diet') || lowerMessage.includes('ăn kiêng')) {
                    return `🥗 **Món ăn ít calo:**\n\n• **Salad Gà** - 320 kcal - 65,000đ\n• **Súp Gà** - 280 kcal - 45,000đ\n• **Cơm Gà Luộc** - 380 kcal - 60,000đ\n• **Rau Củ Hấp** - 150 kcal - 40,000đ\n\nBạn có cần tư vấn thêm về chế độ ăn kiêng không?`;
                } else if (lowerMessage.includes('nhiều người') || lowerMessage.includes('nhóm') || lowerMessage.includes('party')) {
                    return `👨‍👩‍👧‍👦 **Gợi ý cho nhóm đông:**\n\n• **Combo Gia Đình 4 Người** - 250,000đ\n• **Pizza Hải Sản Lớn** - 180,000đ\n• **Set Gà Rán 8 Miếng** - 200,000đ\n• **Combo Party (pizza + gà + khoai + nước)** - 350,000đ\n\nTôi có thể giúp bạn tính toán số lượng phù hợp với nhóm của bạn!`;
                } else {
                    // Default response with suggestions
                    return `🤖 **Tôi có thể giúp bạn tìm món ăn phù hợp!**\n\nHãy cho tôi biết:\n\n1. **Bạn thích loại món nào?** (món chính, đồ ăn nhanh, đồ uống, tráng miệng, combo)\n2. **Ngân sách của bạn** là bao nhiêu?\n3. **Bạn có chế độ ăn đặc biệt** nào không? (chay, ít calo, không đường...)\n\nHoặc bạn có thể hỏi về:\n• 🍽️ Món bán chạy nhất\n• 🎯 Combo tiết kiệm\n• 🎁 Khuyến mãi hiện tại\n• ⏰ Thời gian giao hàng\n• 💰 Phí ship\n\nTôi luôn sẵn sàng hỗ trợ bạn! 😊`;
                }
            }
            
            // Event listeners for sending messages
            function sendMessageHandler(input, target) {
                const message = input.value.trim();
                if (message) {
                    processUserMessage(message, target);
                    input.value = '';
                    
                    // Focus back to input
                    setTimeout(() => {
                        input.focus();
                    }, 100);
                }
            }
            
            if (sendMessageBtn && chatbotInput) {
                sendMessageBtn.addEventListener('click', () => sendMessageHandler(chatbotInput, 'desktop'));
                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessageHandler(chatbotInput, 'desktop');
                    }
                });
            }
            
            if (sendMobileMessageBtn && mobileChatbotInput) {
                sendMobileMessageBtn.addEventListener('click', () => sendMessageHandler(mobileChatbotInput, 'mobile'));
                mobileChatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessageHandler(mobileChatbotInput, 'mobile');
                    }
                });
            }
            
            // Auto-open chatbot on first visit
            const hasVisited = localStorage.getItem('foodgo_chatbot_visited');
            if (!hasVisited && window.innerWidth >= 768) {
                setTimeout(() => {
                    chatbotWindow.classList.remove('hidden');
                    isChatbotOpen = true;
                    localStorage.setItem('foodgo_chatbot_visited', 'true');
                }, 3000);
            }
        }
        
        // Chat history functions
        function saveToChatHistory(message, isUser) {
            const history = JSON.parse(localStorage.getItem('foodgo_chat_history') || '[]');
            history.push({
                message: message,
                isUser: isUser,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 50 messages
            if (history.length > 50) {
                history.splice(0, history.length - 50);
            }
            
            localStorage.setItem('foodgo_chat_history', JSON.stringify(history));
        }
        
        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem('foodgo_chat_history') || '[]');
            
            // If no history, add welcome message
            if (history.length === 0) {
                const welcomeMessage = "Xin chào! Tôi là FoodGo Assistant. Tôi có thể giúp bạn tìm món ăn phù hợp với sở thích và ngân sách của bạn!";
                saveToChatHistory(welcomeMessage, false);
                
                // Add to chat windows
                const chatbotMessages = document.getElementById('chatbot-messages');
                const mobileChatbotMessages = document.getElementById('mobile-chatbot-messages');
                
                if (chatbotMessages) {
                    chatbotMessages.innerHTML = `
                        <div class="chatbot-message">
                            <div class="flex items-end gap-2">
                                <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                    <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                                </div>
                                <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                    <p class="text-sm">${welcomeMessage}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (mobileChatbotMessages) {
                    mobileChatbotMessages.innerHTML = `
                        <div class="chatbot-message">
                            <div class="flex items-end gap-2">
                                <div class="h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center shrink-0">
                                    <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                                </div>
                                <div class="bg-[#f4ede7] dark:bg-[#3d2e1f] rounded-2xl rounded-bl-none px-4 py-3">
                                    <p class="text-sm">${welcomeMessage}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
        }
        
        function saveChatHistory() {
            // This would save the current chat state
            // For now, we rely on the incremental saving in saveToChatHistory
        }
        
        function addUnreadMessage() {
            unreadMessages++;
            const notification = document.getElementById('chat-notification');
            if (notification) {
                notification.textContent = unreadMessages;
                notification.classList.remove('hidden');
                
                // Add animation to launcher
                const launcher = document.getElementById('chatbot-launcher');
                launcher.classList.add('chatbot-launcher');
            }
        }
        
        function clearUnreadMessages() {
            unreadMessages = 0;
            const notification = document.getElementById('chat-notification');
            if (notification) {
                notification.classList.add('hidden');
                
                // Remove animation from launcher
                const launcher = document.getElementById('chatbot-launcher');
                launcher.classList.remove('chatbot-launcher');
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initDemoData();
            checkAuth();
            setupLogout();
            loadCategories();
            loadFoods();
            initChatbot();
            
            // Price range slider
            const priceRange = document.getElementById('price-range');
            const currentPrice = document.getElementById('current-price');
            
            if (priceRange) {
                priceRange.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    currentPrice.textContent = new Intl.NumberFormat('vi-VN').format(value) + 'đ';
                    filters.max_price = value;
                });
            }
            
            // Rating filter buttons
            document.querySelectorAll('.filter-rating').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.filter-rating').forEach(btn => {
                        btn.classList.remove('bg-[#f4ede7]', 'dark:bg-[#3d2e1f]');
                        btn.classList.add('border');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('bg-[#f4ede7]', 'dark:bg-[#3d2e1f]');
                    this.classList.remove('border');
                    
                    filters.min_rating = parseFloat(this.dataset.rating);
                });
            });
            
            // Sort select
            const sortSelect = document.getElementById('sort-select');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    filters.sort_by = this.value;
                    currentPage = 1;
                    loadFoods();
                });
            }
            
            // Apply filters button
            const applyFiltersBtn = document.getElementById('apply-filters');
            if (applyFiltersBtn) {
                applyFiltersBtn.addEventListener('click', function() {
                    currentPage = 1;
                    loadFoods();
                });
            }
            
            // Clear filters button
            const clearFiltersBtn = document.getElementById('clear-filters');
            if (clearFiltersBtn) {
                clearFiltersBtn.addEventListener('click', function() {
                    // Reset all filters
                    filters = {
                        category_id: 0,
                        min_price: 0,
                        max_price: 500000,
                        min_rating: 0,
                        sort_by: 'popular'
                    };
                    
                    // Reset UI
                    document.querySelector('[data-category-id="0"] .category-checkbox').checked = true;
                    document.querySelectorAll('.category-checkbox:not([data-category-id="0"])').forEach(cb => {
                        cb.checked = false;
                    });
                    
                    priceRange.value = 250000;
                    currentPrice.textContent = '250.000đ';
                    
                    document.querySelectorAll('.filter-rating').forEach(btn => {
                        btn.classList.remove('bg-[#f4ede7]', 'dark:bg-[#3d2e1f]');
                        btn.classList.add('border');
                    });
                    
                    sortSelect.value = 'popular';
                    
                    currentPage = 1;
                    loadFoods();
                });
            }
            
            // Pagination buttons
            document.getElementById('prev-page')?.addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    loadFoods();
                }
            });
            
            document.getElementById('next-page')?.addEventListener('click', function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadFoods();
                }
            });
            
            // Search functionality
            const searchInput = document.getElementById('search-input');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            
            function handleSearch() {
                const searchTerm = searchInput?.value || mobileSearchInput?.value || '';
                if (searchTerm.length >= 2) {
                    // Implement search functionality here
                    console.log('Searching for:', searchTerm);
                    // You would typically call an API endpoint to search foods
                    showToast('Tìm kiếm', `Đang tìm kiếm: "${searchTerm}"`);
                }
            }
            
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        handleSearch();
                    }
                });
            }
            
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        handleSearch();
                    }
                });
            }
            
            // Quantity controls in detail view
            const quantityInput = document.getElementById('quantity-input');
            const increaseBtn = document.getElementById('increase-qty');
            const decreaseBtn = document.getElementById('decrease-qty');
            const addToCartDetailBtn = document.getElementById('add-to-cart-detail');
            
            if (increaseBtn) {
                increaseBtn.addEventListener('click', function() {
                    let currentQty = parseInt(quantityInput.value);
                    if (currentQty < 99) {
                        quantityInput.value = currentQty + 1;
                    }
                });
            }
            
            if (decreaseBtn) {
                decreaseBtn.addEventListener('click', function() {
                    let currentQty = parseInt(quantityInput.value);
                    if (currentQty > 1) {
                        quantityInput.value = currentQty - 1;
                    }
                });
            }
            
            if (addToCartDetailBtn) {
                addToCartDetailBtn.addEventListener('click', function() {
                    const quantity = parseInt(quantityInput.value);
                    if (currentFoodId) {
                        // Get food details from current view
                        const foodName = document.getElementById('foodTitle').textContent;
                        const priceText = document.getElementById('foodPrice').textContent;
                        const price = parseInt(priceText.replace(/\D/g, ''));
                        
                        addToCart(currentFoodId, foodName, price);
                    }
                });
            }
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', function(e) {
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileSearchBar = document.getElementById('mobile-search-bar');
                const mobileSearchButton = document.getElementById('mobile-search-button');
                
                if (mobileMenu && mobileMenuButton) {
                    if (!mobileMenu.contains(e.target) && 
                        !mobileMenuButton.contains(e.target) && 
                        !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                }
                
                if (mobileSearchBar && mobileSearchButton) {
                    if (!mobileSearchBar.contains(e.target) && 
                        !mobileSearchButton.contains(e.target) && 
                        !mobileSearchBar.classList.contains('hidden')) {
                        mobileSearchBar.classList.add('hidden');
                    }
                }
            });
        });
        
        // Responsive adjustments on resize
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                document.getElementById('mobile-menu')?.classList.add('hidden');
                document.getElementById('mobile-search-bar')?.classList.add('hidden');
            }
        });
    </script>
</body>
</html>